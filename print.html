<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Parachain Devops Guide</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
                <link rel="stylesheet" href="last-changed.css">
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="chapter-item expanded "><a href="guides/subkey.html"><strong aria-hidden="true">2.</strong> subkey</a></li><li class="chapter-item expanded "><a href="guides/index.html"><strong aria-hidden="true">3.</strong> How-to Guides</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="guides/parachain_deployment.html"><strong aria-hidden="true">3.1.</strong> Parachain Deployment</a></li><li class="chapter-item expanded "><a href="guides/rpc_index.html"><strong aria-hidden="true">3.2.</strong> RPC Deployment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="guides/rpc_kubernetes.html"><strong aria-hidden="true">3.2.1.</strong> Kubernetes</a></li></ol></li><li class="chapter-item expanded "><a href="guides/collator_deployment.html"><strong aria-hidden="true">3.3.</strong> Collator Deployment</a></li><li class="chapter-item expanded "><a href="guides/readiness-checklist.html"><strong aria-hidden="true">3.4.</strong> Parachain Readiness Checklist</a></li></ol></li><li class="chapter-item expanded "><a href="explanations/index.html"><strong aria-hidden="true">4.</strong> Explanations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="deployments/index.html"><strong aria-hidden="true">4.1.</strong> Deployment Options</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="deployments/roles.html"><strong aria-hidden="true">4.1.1.</strong> Node Roles</a></li><li class="chapter-item expanded "><a href="deployments/targets.html"><strong aria-hidden="true">4.1.2.</strong> Remote Targets</a></li><li class="chapter-item expanded "><a href="deployments/options.html"><strong aria-hidden="true">4.1.3.</strong> Role Specific Arguments</a></li></ol></li><li class="chapter-item expanded "><a href="serverdeploy/index.html"><strong aria-hidden="true">4.2.</strong> Server Deployments</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="serverdeploy/systemd.html"><strong aria-hidden="true">4.2.1.</strong> Systemd</a></li><li class="chapter-item expanded "><a href="serverdeploy/logging.html"><strong aria-hidden="true">4.2.2.</strong> Logging</a></li><li class="chapter-item expanded "><a href="serverdeploy/automation.html"><strong aria-hidden="true">4.2.3.</strong> Automation</a></li></ol></li><li class="chapter-item expanded "><a href="kubernetes/index.html"><strong aria-hidden="true">4.3.</strong> Kubernetes Deployments</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="kubernetes/helm.html"><strong aria-hidden="true">4.3.1.</strong> Helm Chart</a></li><li class="chapter-item expanded "><a href="kubernetes/key_injection_test.html"><strong aria-hidden="true">4.3.2.</strong> Key Injection Example</a></li><li class="chapter-item expanded "><a href="kubernetes/testnetmanager.html"><strong aria-hidden="true">4.3.3.</strong> Testnet Manager</a></li></ol></li><li class="chapter-item expanded "><a href="monitoring/index.html"><strong aria-hidden="true">4.4.</strong> Monitoring</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="monitoring/infrastructure.html"><strong aria-hidden="true">4.4.1.</strong> Intrastructure</a></li><li class="chapter-item expanded "><a href="monitoring/polkadot_sdk.html"><strong aria-hidden="true">4.4.2.</strong> Polkadot SDK</a></li></ol></li><li class="chapter-item expanded "><a href="explanations/keys_accounts.html"><strong aria-hidden="true">4.5.</strong> Keys And Accounts</a></li><li class="chapter-item expanded "><a href="explanations/chainspecs.html"><strong aria-hidden="true">4.6.</strong> Chainspecs</a></li></ol></li><li class="chapter-item expanded "><a href="references/index.html"><strong aria-hidden="true">5.</strong> References</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Parachain Devops Guide</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/paritytech/devops-guide" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<p>This guide contains the following sections:</p>
<ul>
<li><a href="./guides/index.html">How-to guides</a>: Getting started with specific use case, eg. deploying a parachain network. </li>
<li><a href="./explanations/index.html">Explanations</a>: Explanations of concepts and configurations relevant to Polkadot blockchain infrastructure.</li>
<li><a href="./references/index.html">References</a>: Index of useful links and tools.</li>
</ul>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="subkey"><a class="header" href="#subkey">Subkey</a></h1>
<p><code>subkey</code> is a cli tool for generating substrate based account. It can also be used for signing and verifying messages, but in this doc we only cover account creation and node key (libp2p) generation.</p>
<h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>In order to install the tool, please reference the substrate documentation: https://docs.substrate.io/reference/command-line-tools/subkey/#installation</p>
<h1 id="generate-substrate-based-accounts"><a class="header" href="#generate-substrate-based-accounts">Generate Substrate Based Accounts</a></h1>
<p>As mentioned earlier, subkey can be used to generate accounts for different substrate chains and parachains, including polkadot, kosama, moonbeam, etc.</p>
<p>By default, <code>substrate generate</code> command generate an account for substrate network. By adding <code>--network &lt;network-name&gt;</code>, one could generate accounts for other networks. </p>
<pre><code>&gt; subkey generate
Secret phrase:       claim year obvious artist also float royal vague industry tackle husband prize
  Network ID:        substrate
  Secret seed:       0x4548be7dc2fa89b3e5600f3933d69ffac4d06e0ac6222ccb9a17fe3cb49ebd9d
  Public key (hex):  0x10938f06b4265ac2bef65bc5d3e3d8ce20b12bc07d2d45ca1463ba2f1a47a078
  Account ID:        0x10938f06b4265ac2bef65bc5d3e3d8ce20b12bc07d2d45ca1463ba2f1a47a078
  Public key (SS58): 5CSSTUxjWVAWSLDxigjsyAF2PXLCznf1FSUhbDooTwaaWQM1
  SS58 Address:      5CSSTUxjWVAWSLDxigjsyAF2PXLCznf1FSUhbDooTwaaWQM1

&gt; substrate generate --network polkadot
Secret phrase:       spell subject sleep celery cigar term neck tube blossom inflict session baby
  Network ID:        polkadot
  Secret seed:       0x50893f76f50855f9ca891dfa55ef64f51ad744f3d643f3f8046ef13b6b249baa
  Public key (hex):  0x847ace070b6bb193659379f1c64e8f3dda721ba545bfaee6fbb717df84ef247f
  Account ID:        0x847ace070b6bb193659379f1c64e8f3dda721ba545bfaee6fbb717df84ef247f
  Public key (SS58): 13zhoUzf3rqj5uzgFAuquf7DrgofKrUHBjUemarXS78G4Bon
  SS58 Address:      13zhoUzf3rqj5uzgFAuquf7DrgofKrUHBjUemarXS78G4Bon
</code></pre>
<ul>
<li>The seed phrase must be saved and stored in a safe place to be able to recover your account information (public and private keys).</li>
<li>The <code>SS58 Address</code> is the account address on different network (aka wallet address).</li>
<li>The <code>Network ID</code> field indicate the network name that this account belongs to.</li>
</ul>
<h1 id="retrieve-accounts-from-the-seed-phrase"><a class="header" href="#retrieve-accounts-from-the-seed-phrase">Retrieve Accounts From the Seed Phrase</a></h1>
<p><code>subkey inspect</code> subcommand can be used to retrieve the account information from the seed phrase:</p>
<pre><code>&gt; subkey inspect &quot;claim year obvious artist also float royal vague industry tackle husband prize&quot;
Secret phrase:       claim year obvious artist also float royal vague industry tackle husband prize
  Network ID:        substrate
  Secret seed:       0x4548be7dc2fa89b3e5600f3933d69ffac4d06e0ac6222ccb9a17fe3cb49ebd9d
  Public key (hex):  0x10938f06b4265ac2bef65bc5d3e3d8ce20b12bc07d2d45ca1463ba2f1a47a078
  Account ID:        0x10938f06b4265ac2bef65bc5d3e3d8ce20b12bc07d2d45ca1463ba2f1a47a078
  Public key (SS58): 5CSSTUxjWVAWSLDxigjsyAF2PXLCznf1FSUhbDooTwaaWQM1
  SS58 Address:      5CSSTUxjWVAWSLDxigjsyAF2PXLCznf1FSUhbDooTwaaWQM1

&gt; subkey inspect --network polkadot &quot;spell subject sleep celery cigar term neck tube blossom inflict session baby&quot;
Secret phrase:       spell subject sleep celery cigar term neck tube blossom inflict session baby
  Network ID:        polkadot
  Secret seed:       0x50893f76f50855f9ca891dfa55ef64f51ad744f3d643f3f8046ef13b6b249baa
  Public key (hex):  0x847ace070b6bb193659379f1c64e8f3dda721ba545bfaee6fbb717df84ef247f
  Account ID:        0x847ace070b6bb193659379f1c64e8f3dda721ba545bfaee6fbb717df84ef247f
  Public key (SS58): 13zhoUzf3rqj5uzgFAuquf7DrgofKrUHBjUemarXS78G4Bon
  SS58 Address:      13zhoUzf3rqj5uzgFAuquf7DrgofKrUHBjUemarXS78G4Bon
</code></pre>
<h1 id="derived-accounts-child-accounts"><a class="header" href="#derived-accounts-child-accounts">Derived Accounts (Child Accounts)</a></h1>
<p>The <code>subkey</code> programs supports creation of sub accounts which are derived from the exact same seed phrase, so that there'd be no need for additional seed phrases for new accounts. One use case is when you want to create multiple accounts for different validators/collators, without needing to create and store many seed phrases.</p>
<p>To derive a child key pair, you add two slashes (//), a derivation path, and an index after the secret phrase associated with its parent key. Because you derive child key pairs and addresses from keys that have been previously generated, you use the subkey inspect command. For example:</p>
<pre><code>&gt; subkey inspect &quot;claim year obvious artist also float royal vague industry tackle husband prize//validator-1//beefy&quot;
  Network ID:        substrate
  Secret seed:       0xb60b7b15155936780cd83063e169bc8402276b253a1d75fa678cc547dd530eb2
  Public key (hex):  0x269c50d4065b4bf58839df4cfc16a11b367b80fbf00d21a96da863d8659e720a
  Account ID:        0x269c50d4065b4bf58839df4cfc16a11b367b80fbf00d21a96da863d8659e720a
  Public key (SS58): 5CwL7TsLnqQKakTfweh5aZ27fe9GHySP86YwbHtLUK3p649g
  SS58 Address:      5CwL7TsLnqQKakTfweh5aZ27fe9GHySP86YwbHtLUK3p649g


&gt; subkey inspect &quot;claim year obvious artist also float royal vague industry tackle husband prize//validator-1//babe&quot;
  Network ID:        substrate
  Secret seed:       0xb31ee2df80a708917b62683579164f625be935a4c3760b24cd3f60f630e0ee2e
  Public key (hex):  0x00493534063762b76cb4ffad8336e57af312c02a6155a871600040de6f1d936a
  Account ID:        0x00493534063762b76cb4ffad8336e57af312c02a6155a871600040de6f1d936a
  Public key (SS58): 5C55c1YcFWQV6XdFCQVpG52K1SjgZqWKDvg7uNe9PFX4Hc9x
  SS58 Address:      5C55c1YcFWQV6XdFCQVpG52K1SjgZqWKDvg7uNe9PFX4Hc9x
</code></pre>
<p><strong>Important Note:</strong> Both seed phrase and derivation paths need to be stored to be able to arrive at the key for an address. Only use custom derivation paths if you are comfortable with your knowledge of this topic.</p>
<h1 id="generate-node-keys-libp2p-keys"><a class="header" href="#generate-node-keys-libp2p-keys">Generate Node Keys (<code>libp2p</code> Keys)</a></h1>
<p>Use the <code>subkey generate-node-key</code> command to generate random public and private keys for peer-to-peer (<code>libp2p</code>) communication between Substrate nodes. The public key is the peer identifier that is used in chain specification files or as a command-line argument to identify a node participating in the blockchain network. In most cases, you run this command with a command-line option to save the private key to a file.</p>
<p>To generate a random key pair for peer-to-peer communication and save the secret key in a file, run a command similar to the following:</p>
<pre><code>&gt; subkey generate-node-key --file ../generated-node-key
12D3KooWMUsb8yizAaQiFRPtuqJTK9c7CSektH5YFV3MGxHGJbnV
</code></pre>
<p>This command displays the peer identifier for the node key in the terminal and the private key is saved in the generated-node-key file. In this example, the saved key in the parent directory instead of the current working directory.</p>
<pre><code>12D3KooWHALHfL7dDBiGTt4JTEAvCbDWts8zHwvcPvJXDF9fxue7
</code></pre>
<p>Use the <code>subkey inspect-node-key</code> command to display the peer identifier for the node that corresponds with the node key in the specified file name. Before using this command, you should have previously used the <code>subkey generate-node-key</code> command and saved the key to a file.</p>
<pre><code>&gt; subkey inspect-node-key --file &lt;file-name&gt;
</code></pre>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-guides"><a class="header" href="#how-to-guides">How-to Guides</a></h1>
<p>This section provides useful guides for getting started with Polkadot infrastructure.</p>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="guide-deploying-a-parachain-network"><a class="header" href="#guide-deploying-a-parachain-network">Guide: Deploying a Parachain Network</a></h1>
<p>This guide demonstrates the deployment of a parachain test network composed of 2 collators (nodes authoring blocks) and 1 RPC node.
We are using Rococo as an example, but this approach would work similarly for any Relaychain, whether it is a testnet (Westend, Rococo, Paseo) or a mainnet (Polkadot, Kusama).</p>
<h2 id="preparations"><a class="header" href="#preparations">Preparations</a></h2>
<h3 id="hardware"><a class="header" href="#hardware">Hardware</a></h3>
<p>For this example network, you will need 3 machines.
The specifications of these machines will depend on your intended usage. For a testnet, medium-sized virtual machines with 2 to 4 cores will suffice. However, for mainnet nodes, it is recommended to follow the  <a href="https://wiki.polkadot.network/docs/maintain-guides-how-to-validate-polkadot#reference-hardware">&quot;validator reference hardware&quot; as detailed in the Polkadot Wiki</a>.</p>
<p>Requirements:</p>
<ul>
<li>The machines should have a public IP and allow network access on their P2P ports (defaults 30333 and 30334) as well as the RPC port for the RPC node (9944 for ws or 443 for wss).</li>
<li>The machine should have a big enough disk to host the relay-chain pruned database (&gt;250 GB for Rococo)</li>
<li>You should have obtained SSH access to these machines.</li>
</ul>
<h3 id="parachain-binary-or-docker-image"><a class="header" href="#parachain-binary-or-docker-image">Parachain binary or docker image</a></h3>
<h3 id="prepare-the-binary-for-use-with-ansible"><a class="header" href="#prepare-the-binary-for-use-with-ansible">Prepare the binary for use with Ansible</a></h3>
<p>To deploy your network with the <a href="https://github.com/paritytech/ansible-galaxy/blob/main/roles/node">Ansible node role</a>, you will need to have the node binary available from a public URL.
If this binary is not already available for your parachain, you will need to build it yourself using the following command:</p>
<pre><code>cargo build --release
</code></pre>
<p>Then publish the node binary present in <code>target/releases</code> somewhere and note down the public URL. One option to do this is to add it as a <a href="https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository">GitHub release asset</a>.
In this guide, we will use the <code>parachain-template-node</code> that you can get from <a href="https://github.com/paritytech/polkadot-sdk-parachain-template/releases">paritytech/polkadot-sdk-parachain-template's releases assets</a>.</p>
<p>To deploy system parachain nodes, such as asset-hub and bridge-hub, you should use the <code>polkadot-parachain</code> binary published on <a href="https://github.com/paritytech/polkadot-sdk/releases/latest">https://github.com/paritytech/polkadot-sdk/releases/latest/</a>.</p>
<h3 id="prepare-the-docker-image-for-use-with-kubernetes"><a class="header" href="#prepare-the-docker-image-for-use-with-kubernetes">Prepare the docker image for use with Kubernetes</a></h3>
<p>To deploy your network with the <a href="https://github.com/paritytech/helm-charts/tree/main/charts/node">node helm-chart</a>, you will need to have a node docker image published to a public registry.</p>
<h2 id="generate-parachain-private-keys"><a class="header" href="#generate-parachain-private-keys">Generate parachain private keys</a></h2>
<h3 id="generate-static-node-keys-aka-network-keys"><a class="header" href="#generate-static-node-keys-aka-network-keys">Generate static node keys (aka network keys)</a></h3>
<p>Node keys are used to identify nodes on the P2P network with a unique PeerID.
To ensure this identifier persists across restarts, it is highly recommended to generate a static network key for all nodes.
This practice is particularly important for bootnodes, which have publicly listed addresses that are used by other nodes to bootstrap their connections to the network.</p>
<p>To generate a static node key:</p>
<pre><code>parachain-template-node key generate-node-key --file node.key
# example output
12D3KooWExcVYu7Mvjd4kxPVLwN2ZPnZ5NyLZ5ft477wqzfP2q6E # PeerId (hash of public node key)
cat node.key
d5e120e30dfb0eac39b1a6727d81c548e9c6b39ca97e565438a33d87726781a6% # private node key, do not copy the percent sign
</code></pre>
<h3 id="generate-keys-for-your-collators-accountaura-keys"><a class="header" href="#generate-keys-for-your-collators-accountaura-keys">Generate keys for your collators (account+aura keys)</a></h3>
<p>For parachains using the collatorSelection pallet to manage their collator set, you will need to generate a set of keys for each collator:</p>
<ul>
<li>Collator Account: a regular substrate account</li>
<li>Aura keys (part of the collator “session keys”)</li>
</ul>
<p>In this example, we will use the same seed for both. Use the following command generate a secret seed for each collator:</p>
<pre><code>parachain-template-node key generate
</code></pre>
<p>You can derive public keys and account IDs from an existing seed by using:</p>
<pre><code>parachain-template-node  key inspect &quot;&lt;secret-seed&gt;&quot;
# example output
Secret Key URI `//Alice` is account:
  Network ID:        substrate
  Secret seed:       0xe5be9a5092b81bca64be81d212e7f2f9eba183bb7a90954f7b76361f6edb5c0a
  Public key (hex):  0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d
  Account ID:        0xd43593c715fdd31c61141abd04a99fd6822c8558854ccde39a5684e7a56da27d
  Public key (SS58): 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
  SS58 Address:      5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
</code></pre>
<h2 id="reserve-a-paraid-on-rococo"><a class="header" href="#reserve-a-paraid-on-rococo">Reserve a ParaId on Rococo</a></h2>
<p>Note: although it is possible to use specific UIs for registering your parachain, this guide only documents how to do it by submitting extrinsics directly through the Polkadot.js Console.</p>
<p>To get reserve a ParaId for your parachain on Rococo, navigate to the <a href="https://polkadot.js.org/apps/?rpc=wss%3A%2F%2Frococo-rpc.polkadot.io">Polkadot.js Apps interface</a>.</p>
<ul>
<li>Ensure you are connected to the Rococo network by selecting the appropriate RPC endpoint (<code>wss://rococo-rpc.polkadot.io</code>).</li>
<li>Go to the &quot;Developer&quot; tab and select &quot;Extrinsics&quot;.</li>
<li>Choose <code>registrar.reserve</code> from the dropdown menu and execute it with your account.</li>
<li>Check the included extrinsic result in the block to find your reserved <code>para_id</code> and note it down.</li>
</ul>
<h2 id="create-your-network-chainspec"><a class="header" href="#create-your-network-chainspec">Create your Network Chainspec</a></h2>
<p>When launching a new parachain network, customizing the chainspec (chain specification) is a crucial step.</p>
<h3 id="export-your-runtime-file"><a class="header" href="#export-your-runtime-file">Export your runtime file</a></h3>
<p>First export your runtime file from your node binary (here <code>--raw</code> is used to export the output as binary not hex string):</p>
<pre><code>parachain-template-node export-genesis-wasm --raw &gt; runtime.wasm
</code></pre>
<p>If you want to select a specific built-in runtimle of your binary, add <code>--chain chain-name</code> to your command.</p>
<h3 id="prepare-your-genesis-patch-config"><a class="header" href="#prepare-your-genesis-patch-config">Prepare your genesis patch config</a></h3>
<p>Save the following to <code>genesis-patch.json</code> (replace keys and configuration with your own):</p>
<pre><code class="language-json">{
  &quot;balances&quot;: {
    &quot;balances&quot;: [
      [
        &quot;5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY&quot;,
        1152921504606846976
      ],
      [
        &quot;5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty&quot;,
        1152921504606846976
      ]
    ]
  },
  &quot;collatorSelection&quot;: {
    &quot;candidacyBond&quot;: 16000000000,
    &quot;invulnerables&quot;: [
      &quot;5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY&quot;,
      &quot;5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty&quot;
    ]
  },
  &quot;session&quot;: {
    &quot;keys&quot;: [
      [
        &quot;5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY&quot;,
        &quot;5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY&quot;,
        {
          &quot;aura&quot;: &quot;5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY&quot;
        }
      ],
      [
        &quot;5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty&quot;,
        &quot;5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty&quot;,
        {
          &quot;aura&quot;: &quot;5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty&quot;
        }
      ]
    ]
  },
  &quot;parachainInfo&quot;: {
    &quot;parachainId&quot;: 4435
  },
  &quot;polkadotXcm&quot;: {
    &quot;safeXcmVersion&quot;: 4
  },
  &quot;sudo&quot;: {
    &quot;key&quot;: &quot;5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY&quot;
  }
}
</code></pre>
<p>In this example:</p>
<ul>
<li><code>balances</code>: initial account balances</li>
<li><code>collatorSelection</code>: configure the collatorSelection pallet properties, in this example we set Alice and Bob as initial invulnerable collators.</li>
<li><code>session.keys</code>: initial session keys</li>
<li><code>parachainInfo.parachainId</code>: parachain ID</li>
<li><code>sudo.keys</code>: initial sudo key account</li>
</ul>
<p>Note that:</p>
<ul>
<li><code>5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY</code>: Alice's account address</li>
<li><code>5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty</code>: Bob's account address</li>
</ul>
<h3 id="generate-a-customized-plain-chainspec"><a class="header" href="#generate-a-customized-plain-chainspec">Generate a customized plain Chainspec</a></h3>
<p>With the <strong>chain-spec-builder</strong> utility, we can generate a chainspec file using only the runtime wasm file 
on which we will apply a patch describing the customized genesis config we want to apply</p>
<p>Download the chain-spec-builder binary from the latest <a href="https://github.com/paritytech/polkadot-sdk/releases/latest">polkadot-sdk releases</a>.
Then execute it, taking as input the runtime and genesis patch files:</p>
<pre><code class="language-bash">chain-spec-builder -c chainspec.plain.json create -n &quot;Test Parachain&quot; -i test-parachain -t live -r runtime.wasm patch genesis.patch.json
</code></pre>
<p>To work properly as a parachain chainspec, add the following fields to your <code>chainspec.plain.json</code>:</p>
<pre><code>{
  &quot;protocolId&quot;: &quot;template-local&quot;,
  &quot;properties&quot;: {
    &quot;ss58Format&quot;: 42,
    &quot;tokenDecimals&quot;: 12,
    &quot;tokenSymbol&quot;: &quot;UNIT&quot;
  },
  &quot;para_id&quot;: 4435,
  &quot;relay_chain&quot;: &quot;rococo&quot;,
  ...
</code></pre>
<p>You also need to set your <code>bootNodes</code> addresses, any node which has a public IP or DNS can be a bootnode:</p>
<pre><code class="language-json">{
  &quot;bootNodes&quot;: [
    # eg. IP bootnode
    &quot;/ip4/&lt;Node-Public-IP&gt;/tcp/30333/p2p/&lt;Node-ID&gt;&quot;
    # eg. DNS bootnode
    &quot;/dns/&lt;Node-Public-DNS&gt;/tcp/30333/p2p/&lt;Node-ID&gt;&quot;,
    # (Optional) WSS Bootnodes (for light clients, requires a TLS cert, see https://wiki.polkadot.network/docs/maintain-bootnode)   
    &quot;/dns/&lt;Node-Public-DNS&gt;/tcp/443/wss/p2p/&lt;Node-ID&gt;&quot;,
  ...
}
</code></pre>
<h3 id="convert-your-plain-chainspec-to-raw"><a class="header" href="#convert-your-plain-chainspec-to-raw">Convert your Plain Chainspec to Raw</a></h3>
<p>To initialize the genesis storage for your chain, you need convert your chainspec from plain to raw format.
This process transforms the human-readable keys in the plain chainspec into actual storage keys and defines a unique genesis block.</p>
<p>A unique <a href="https://docs.substrate.io/build/chain-spec/#raw-chain-specifications">raw chainspec</a> can be created from the plain chainspec with this command:</p>
<pre><code>parachain-template-node build-spec --chain chainspec.plain.json --raw &gt;  chainspec.raw.json
</code></pre>
<p>⚠️ Only use the raw chainspec to launch your chain, not the plain chainspec.</p>
<h3 id="optional-dry-run-your-parachain-network-locally"><a class="header" href="#optional-dry-run-your-parachain-network-locally">(Optional) Dry-run your Parachain Network Locally</a></h3>
<p>You should now have everything ready to launch your network locally to validate that everything is properly set up.</p>
<ul>
<li>Start your node (we use the <code>--tmp</code> flag to prevent the node database files from being persisted to disk):</li>
</ul>
<pre><code>parachain-template-node  --chain chainspec.raw.json --tmp
</code></pre>
<ul>
<li>Connect to it with <a href="https://polkadot.js.org/apps/?rpc=ws%3A%2F%2F127.0.0.1%3A9944">Polkadot.js Apps</a> on <code>ws://127.0.0.1:9944</code>.</li>
<li>You can inspect the <a href="https://polkadot.js.org/apps/?rpc=ws%3A%2F%2F127.0.0.1%3A9944#/chainstate">chain state in Polkadot.js Apps</a> to verify that everything is in order for the launch.</li>
</ul>
<p>Note: if you look at the node logs, it should be starting to sync the relay-chain (Rococo in our case). You don’t have to wait until it is fully synced.</p>
<h2 id="deploy-your-nodes"><a class="header" href="#deploy-your-nodes">Deploy your nodes</a></h2>
<p>You can use any method you choose to set up your nodes on your machines, we recommend either Ansible </p>
<h3 id="deploy-your-nodes-with-ansible"><a class="header" href="#deploy-your-nodes-with-ansible">Deploy your nodes with Ansible</a></h3>
<p>Clone the project at <a href="https://github.com/paritytech/parachain-deployment-quickstart/">paritytech/parachain-deployment-quickstart</a> and follow instructions in the <code>ansible</code> folder.</p>
<h3 id="deploy-your-nodes-with-kubernetes"><a class="header" href="#deploy-your-nodes-with-kubernetes">Deploy your nodes with Kubernetes</a></h3>
<p>Clone the project at <a href="https://github.com/paritytech/parachain-deployment-quickstart/">paritytech/parachain-deployment-quickstart</a> and follow instructions in the <code>kubernetes</code> folder.</p>
<h2 id="register-and-activate-your-parachain-on-the-relaychain"><a class="header" href="#register-and-activate-your-parachain-on-the-relaychain">Register and activate your Parachain on the Relaychain</a></h2>
<h3 id="register-parachain-genesis-code-and-state-on-relay-chain"><a class="header" href="#register-parachain-genesis-code-and-state-on-relay-chain">Register parachain genesis code and state on relay-chain</a></h3>
<p>You can export the genesis runtime (WASM code) and state files from your chainspec. Then, these files can be registered on the relaychain to initialize your parachain.</p>
<ul>
<li>Export the genesis state:</li>
</ul>
<pre><code>parachain-template-node  export-genesis-state --chain chainspec.raw.json &gt; genesis_state_head
</code></pre>
<ul>
<li>Export the genesis runtime:</li>
</ul>
<pre><code>parachain-template-node  export-genesis-wasm --chain chainspec.raw.json &gt; genesis_wasm_code
</code></pre>
<ul>
<li>Register your parachain genesis configuration on the relay-chain by executing the <code>registrar.register</code> extrinsic on Rococo:
<ul>
<li><code>id</code>: your parachain ID</li>
<li><code>genesisHead</code>: select the <code>genesis_state_head</code> file</li>
<li><code>validationCode</code>: select the <code>genesis_wasm_code</code> file</li>
</ul>
</li>
</ul>
<h3 id="obtain-on-demand-coretime-to-produce-your-first-block"><a class="header" href="#obtain-on-demand-coretime-to-produce-your-first-block">Obtain on-demand coretime to produce your first block</a></h3>
<ul>
<li>Execute extrinsic: <code>onDemandAssignmentProvider.placeOrderAllowDeath</code> or <code>onDemandAssignmentProvider.placeOrderKeepAlive</code>:
<ul>
<li><code>maxAmount</code>: <code>10000000000000</code> (13 zeros, ie. 10 ROC)</li>
<li><code>paraId</code>: your parachain ID</li>
</ul>
</li>
</ul>
<p>After executing this, you should have successfully produced your first block !</p>
<pre><code>INFO tokio-runtime-worker substrate: [Parachain] ✨ Imported #1 (0xa075…10d6)
</code></pre>
<h2 id="manage-coretime-for-your-chain"><a class="header" href="#manage-coretime-for-your-chain">Manage Coretime for your chain</a></h2>
<p>To allow your parachain to produce blocks it needs to be allocated <a href="https://wiki.polkadot.network/docs/learn-agile-coretime">coretime</a> (time allocated for utilizing a core) on the relaychain.
What we mean by &quot;core&quot; is the ability of the relaychain (and its validators) to validate the new blocks of a parachain (received from the collators) so that they are “included” in Polkadot as finalized parachain blocks.</p>
<p>There are 2 types of coretime:</p>
<ul>
<li><strong>On-demand coretime</strong>: lets users buy coretime by the block. Useful for parachains which don’t require continuous block production</li>
<li><strong>Bulk coretime</strong>: an allocation of uninterrupted 28 days (default region length) of coretime (possibly split in timeslices)</li>
</ul>
<p>For more information, please refer to the <a href="https://wiki.polkadot.network/docs/learn-guides-coretime-parachains">Parachain Coretime Guide</a>.</p>
<h3 id="reserve-bulk-coretime"><a class="header" href="#reserve-bulk-coretime">Reserve Bulk Coretime</a></h3>
<ul>
<li>Go on <a href="https://www.lastic.xyz/rococo/bulkcore1">Lastic Rococo Coretime Sales page</a> and buy 1 core</li>
<li>Go on <a href="https://www.lastic.xyz/rococo/my-cores">Lastic Rococo Homepage</a>, click on the “core nb X” that you own to show its dedicated page, then click &quot;assign core&quot;.
Assign it to your ParaID and Finality: <code>Final</code></li>
</ul>
<p>Note: any account with enough funds can buy and assign coretime for a parachain.</p>
<h3 id="renew-bulk-coretime"><a class="header" href="#renew-bulk-coretime">Renew Bulk Coretime</a></h3>
<p>TODO</p>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="rpc-overview"><a class="header" href="#rpc-overview">RPC Overview</a></h1>
<p>An RPC node is a server that allows external applications to interact with the Polkadot chain. This interaction is facilitated through a set of standardized APIs which enable the execution of various operations and retrieval of blockchain data. Here are some key points about an RPC node in Polkadot:</p>
<p>Functions of an RPC Node:
<em>Querying Blockchain Data</em>: RPC nodes can be used to fetch information from the blockchain, such as block details, transaction histories, account balances, and other state information.
<em>Submitting Transactions</em>: External applications can use RPC nodes to broadcast transactions to the network. This includes sending tokens, executing smart contracts, or any other transaction type supported by Polkadot.
<em>Subscription to Events</em>: RPC nodes can provide real-time updates on blockchain events, such as new blocks being added, changes in account balances, or other relevant blockchain events.
<em>Chain State and Metadata</em>: RPC nodes allow applications to query the current state of the blockchain, as well as metadata about the runtime environment, including the version of the Polkadot runtime, the list of available RPC methods, and more.</p>
<h3 id="type-of-rpc-nodes"><a class="header" href="#type-of-rpc-nodes">Type of RPC Nodes</a></h3>
<p>There are two common types of RPC nodes: <em>archive</em> nodes and <em>pruned</em> nodes, which differ in data storage and access.</p>
<ul>
<li>
<p><strong>Archive Nodes</strong>:</p>
<ul>
<li>Store the entire blockchain history, providing full state access for tasks requiring historical data, such as analytics and audits.</li>
<li>Require substantial disk space.</li>
<li><strong>Important Flag</strong>: <code>--state-pruning archive --blocks-pruning archive</code> (Ensures the node retains all historical data)</li>
</ul>
</li>
<li>
<p><strong>Pruned Nodes</strong>:</p>
<ul>
<li>Retain only recent data, offering limited historical access but using significantly less storage.</li>
<li>Suitable for most day-to-day operations and network security.</li>
<li><strong>Important Flag</strong>: <code>--state-pruning 1000</code> (Only keeps last 1000 of finalized blocks)</li>
</ul>
</li>
</ul>
<p>While archive nodes are essential for applications needing comprehensive historical data, pruned nodes are sufficient for wallets, validators, and other typical uses.</p>
<h3 id="important-flags-for-running-an-rpc-node"><a class="header" href="#important-flags-for-running-an-rpc-node">Important Flags for Running an RPC Node</a></h3>
<ol>
<li>
<p><strong><code>--rpc-methods</code></strong>: Defines which RPC methods are available.</p>
<ul>
<li>Example: <code>--rpc-methods=Unsafe</code></li>
<li>Options: <code>Auto</code>, <code>Safe</code>, <code>Unsafe</code></li>
</ul>
</li>
<li>
<p><strong><code>--rpc-cors</code></strong>: Specifies the Cross-Origin Resource Sharing (CORS) settings.</p>
<ul>
<li>Example: <code>--rpc-cors=all</code> (Allow all origins)</li>
<li>Example: <code>--rpc-cors=http://localhost:3000</code> (Allow specific origin)</li>
</ul>
</li>
<li>
<p><strong><code>--rpc-port</code></strong>: Sets the port on which the RPC server listens.</p>
<ul>
<li>Example: <code>--rpc-port=9933</code></li>
</ul>
</li>
<li>
<p><strong><code>--rpc-external</code></strong>: Allows RPC connections from external sources.</p>
<ul>
<li>Example: <code>--rpc-external</code></li>
</ul>
</li>
<li>
<p><strong><code>--rpc-rate-limit</code></strong>: RPC rate limiting (calls/minute) for each connection..</p>
<ul>
<li>Example: <code>--rpc-rate-limit=100</code></li>
</ul>
</li>
<li>
<p><strong><code>--unsafe-rpc-external</code></strong>: Same as <code>--rpc-external</code></p>
<ul>
<li>Example: <code>--unsafe-rpc-external</code></li>
</ul>
</li>
</ol>
<h3 id="securing-the-ws-port"><a class="header" href="#securing-the-ws-port">Securing the WS Port</a></h3>
<p>Securing the WebSocket (WS) port is essential to prevent unauthorized access and potential security threats such as data breaches, man-in-the-middle attacks, and denial-of-service attacks. It is also necessary to access the node from the Polkadot-js UI.</p>
<h4 id="tools-for-securing-websocket-connections"><a class="header" href="#tools-for-securing-websocket-connections">Tools for Securing WebSocket Connections</a></h4>
<p>A list of most common tools available that supports securing websocket:</p>
<ol>
<li>
<p><strong>NGINX</strong>: A popular web server and reverse proxy that can be configured to handle WebSocket connections securely.</p>
<ul>
<li><strong>Documentation</strong>: <a href="https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/">NGINX WebSocket Support</a></li>
</ul>
</li>
<li>
<p><strong>HAProxy</strong>: A high-performance TCP/HTTP load balancer that can manage WebSocket connections securely.</p>
<ul>
<li><strong>Documentation</strong>: <a href="http://www.haproxy.org/#docs">HAProxy WebSocket Support</a></li>
</ul>
</li>
<li>
<p><strong>Traefik</strong>: A modern reverse proxy and load balancer that supports WebSocket connections and integrates well with various security features.</p>
<ul>
<li><strong>Documentation</strong>: <a href="https://doc.traefik.io/traefik/providers/websocket/">Traefik WebSocket Support</a></li>
</ul>
</li>
<li>
<p><strong>Cloudflare</strong>: Provides WebSocket support along with security features like DDoS protection and WAF.</p>
<ul>
<li><strong>Documentation</strong>: <a href="https://developers.cloudflare.com/using-cloudflare/website-performance/websockets/">Cloudflare WebSocket Support</a></li>
</ul>
</li>
<li>
<p><strong>AWS Application Load Balancer (ALB)</strong>: Supports WebSocket connections and integrates with AWS WAF for additional security.</p>
<ul>
<li><strong>Documentation</strong>: <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html">AWS ALB WebSocket Support</a></li>
</ul>
</li>
<li>
<p><strong>Caddy</strong>: A web server with automatic HTTPS that can also handle WebSocket connections securely.</p>
<ul>
<li><strong>Documentation</strong>: <a href="https://caddyserver.com/docs/reverse-proxy#websocket">Caddy WebSocket Support</a></li>
</ul>
</li>
</ol>
<h3 id="how-to-guides-1"><a class="header" href="#how-to-guides-1">How-to Guides</a></h3>
<p>This section provides a deployment guide for an RPC node via Ansible and Kubernetes.</p>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="guide-deploying-an-rpc-node"><a class="header" href="#guide-deploying-an-rpc-node">Guide: Deploying an RPC node</a></h1>
<p>This guide demonstrates the deployment of an RPC node via Helm chart in Kubernetes.</p>
<h2 id="preparations-1"><a class="header" href="#preparations-1">Preparations</a></h2>
<p>Parity maintains a helm GitHub repo @ <a href="https://github.com/paritytech/helm-charts">https://github.com/paritytech/helm-charts</a> - Inside this repo is the <a href="https://github.com/paritytech/helm-charts/tree/main/charts/node">node</a> chart which can be used for deploying your Substrate/Polkadot binary.</p>
<p>All variables are documented clearly in the <a href="https://github.com/paritytech/helm-charts/blob/main/charts/node/README.md">README.md</a> and there’s an example <a href="https://github.com/paritytech/helm-charts/tree/main/charts/node/examples/local-rococo">local-rococo</a> which you can start working from.</p>
<h4 id="helm-deployment"><a class="header" href="#helm-deployment">Helm Deployment</a></h4>
<p>Binary images are available at Dockerhub. Parity maintains both <a href="https://hub.docker.com/r/parity/polkadot">Polkadot</a> and <a href="https://hub.docker.com/r/parity/polkadot-parachain">Polkadot-Parachain</a> images from the <a href="https://github.com/paritytech/polkadot-sdk">polkadot-sdk</a> repo.</p>
<p>When running an RPC node, a sidecar called <a href="https://github.com/paritytech/scripts/tree/master/dockerfiles/ws-health-exporter">ws-health-exporter</a> is good to have to allow a readiness endpoint for Kubernetes.</p>
<pre><code class="language-bash">helm repo add parity https://paritytech.github.io/helm-charts/
helm -n NAMESPACE upgrade --install RELEASE_NAME -f FILE_NAME.yml parity/node
</code></pre>
<h4 id="relaychain-helm-values"><a class="header" href="#relaychain-helm-values">Relaychain Helm Values</a></h4>
<pre><code>image:
  repository: parity/polkadot
  tag: v1.14.0
node:
  replicas: 1
  chain: rococo
  role: full
  chainData:
    chainPath: rococo_v2_2
    # chainSnapshot:
    #   enabled: true
    #   method: http-filelist
    #   url: https://snapshots.polkadot.io/rococo-paritydb-archive
    volumeSize: 600Gi
    storageClass: ssd-csi
    database: paritydb
    pruning: archive
  chainKeystore:
    mountInMemory:
      enabled: true
  flags:
    - &quot;--rpc-max-connections 5000&quot;
  perNodeServices:
    relayP2pService:
      enabled: true
      type: NodePort
    setPublicAddressToExternalIp:
      enabled: true
  persistGeneratedNodeKey: true
  enableOffchainIndexing: true
  serviceMonitor:
    enabled: true
  tracing:
    enabled: false
  resources:
    requests:
      cpu: 500m
      memory: 2Gi
    limits:
      cpu: 4
      memory: 7Gi

# RPC Endpoint
ingress:
  enabled: false
  annotations:
    kubernetes.io/ingress.class: TODO
    external-dns.alpha.kubernetes.io/target: TODO
    cert-manager.io/cluster-issuer: TODO
  host: parachain.example.com
  tls:
    - secretName: parachain.example.com
      hosts:
        - parachain.example.com

extraContainers:
- name: ws-health-exporter
  image: docker.io/paritytech/ws-health-exporter:0a2e6e9b-20230412
  env:
  - name: WSHE_NODE_RPC_URLS
    value: &quot;ws://127.0.0.1:9944&quot;
  - name: WSHE_NODE_MAX_UNSYNCHRONIZED_BLOCK_DRIFT
    value: &quot;4&quot;
  - name: WSHE_NODE_MIN_PEERS
    value: &quot;2&quot;
  resources:
    requests:
      cpu: 10m
      memory: 32M
    limits:
      cpu: 100m
      memory: 64M
  readinessProbe:
    httpGet:
      path: /health/readiness
      port: 8001
</code></pre>
<h4 id="parachains-helm-values"><a class="header" href="#parachains-helm-values">Parachains Helm Values</a></h4>
<pre><code>  image:
    repository: parity/polkadot-parachain
    tag: 1.14.0
  node:
    chain: bridge-hub-rococo
    command: polkadot-parachain
    replicas: 1
    role: full
    chainData:
      database: paritydb
      pruning: archive
      volumeSize: 50Gi
      storageClass: ssd-csi
    chainKeystore:
      mountInMemory:
        enabled: true
    isParachain: true
    collatorRelayChain:
      chain: rococo
      chainData:
        database: paritydb
        pruning: 1000
        storageClass: ssd-csi
        volumeSize: 150Gi
        # chainSnapshot:
        #   enabled: true
        #   method: http-filelist
        #   url: https://snapshots.polkadot.io/rococo-paritydb-prune
        chainPath: rococo_v2_2
      chainKeystore:
        mountInMemory:
          enabled: true
    flags:
      - &quot;--rpc-max-connections 1000&quot;
    perNodeServices:
      relayP2pService:
        enabled: true
        type: NodePort
      paraP2pService:
        enabled: true
        type: NodePort
      setPublicAddressToExternalIp:
        enabled: true
    resources:
      requests:
        cpu: 1
        memory: 2Gi
      limits:
        memory: 4Gi
        
# RPC Endpoint
ingress:
  enabled: false
  annotations:
    kubernetes.io/ingress.class: TODO
    external-dns.alpha.kubernetes.io/target: TODO
    cert-manager.io/cluster-issuer: TODO
  host: parachain.example.com
  tls:
    - secretName: parachain.example.com
      hosts:
        - parachain.example.com
</code></pre>
<h3 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h3>
<ul>
<li>The advantage of running in Kubernetes is the number of replicas can easily be added behind an ingress. </li>
<li>A backup is ideally used due to easily scale up new RPC nodes</li>
<li>Enabling serviceMonitor to enable monitoring of the RPC nodes</li>
</ul>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Collators are members of the network that maintain the parachains they take part in. Collators produce the state transition proof for relay chain validators but also author the blocks for the parachain and pass them to relay chain. There are some requirements that need to be considered prior to becoming a collator candidate including machine, bonding, account, and community requirements. For more info regarding collators, reference <a href="https://wiki.polkadot.network/docs/learn-collator">collator section</a> on Polkadot wiki page.</p>
<p>This doc demonstrates how to add new collators to an already running parachain.</p>
<h1 id="hardware-requirements"><a class="header" href="#hardware-requirements">Hardware Requirements</a></h1>
<p>Make sure your instance has at least the minimum recommended harware requirements:</p>
<ul>
<li>CPU: 2 Cores - Intel Xeon E-2386/2388 or Ryzen 9 5950x/5900x</li>
<li>Memory: 8GB </li>
<li>Disk: Depending on the chain size - 200GB SSD/nvme</li>
</ul>
<h1 id="launch-the-collator"><a class="header" href="#launch-the-collator">Launch the Collator</a></h1>
<p>1- Generate an Account
2- Run the Collator
3- Bind The Account With Collator's Session Keys
4- Bond Funds</p>
<h2 id="1--create-an-account"><a class="header" href="#1--create-an-account">1- Create an Account</a></h2>
<p>This account is used to hold funds and submit the extrinsics to bond and register your collator as candidate.</p>
<pre><code>&gt; subkey generate
Secret phrase:       crane material doll wife text jaguar cross donor crane caught soft permit
  Network ID:        substrate
  Secret seed:       0x79613c5ccb1c8aa9c21e1ddb2fbf65c8e979649cd52cfe041391c9f9d07ec3e9
  Public key (hex):  0x4a503b20b3ada9ff3bf985271b5756e650a83ae47e44a7552dc2415ce8060a52
  Account ID:        0x4a503b20b3ada9ff3bf985271b5756e650a83ae47e44a7552dc2415ce8060a52
  Public key (SS58): 5Dk9EY7iUbjLX6fTDnbFZVGdnN7v2NgQtxj4Y7YjjZXgpCjE
  SS58 Address:      5Dk9EY7iUbjLX6fTDnbFZVGdnN7v2NgQtxj4Y7YjjZXgpCjE
</code></pre>
<p>Store the secret phrase in a secure place. This account will be used on PolkadotJS app to bind you collator session keys to it.</p>
<h2 id="2--run-the-collator"><a class="header" href="#2--run-the-collator">2- Run the Collator</a></h2>
<p>Now that we have node keys ready, it's time to the collator with the provided chainspec to sync our node with network. Depending on the chain size (both relay and para chains), this will take some time until the node is completely synced with the network:</p>
<pre><code class="language-bash">./target/release/parachain-node-template --collator \
--name collator1 \
--base-path /tmp/parachain/collator1 \
--chain parachain-chainspec-raw.json \
--collator \ 
--rpc-port 10001 \
--ws-port 10002 \
--listen-addr /ip4/0.0.0.0/tcp/10003/ws \
-- \
--chain /{PATH_TO_RELAYCHAIN_CHAINSPEC} \
--port 10004 \
--ws-port 10005
</code></pre>
<p>Before jumping to the next steps, you have to wait until your node is fully synchronized:</p>
<pre><code class="language-bash">journalctl -f -u shibuya-node -n100
</code></pre>
<h2 id="3--bind-your-account-with-session-keys"><a class="header" href="#3--bind-your-account-with-session-keys">3- Bind Your Account with Session Keys</a></h2>
<p>Session keys are a set of cryptographic keys used by collators/validators to securely participate in the consensus mechanism and perform various roles within the network. These keys are essential for ensuring the integrity and security of the blockchain.</p>
<p>As a collator, you need to link your session keys to your collator account (The account which is created in step 1 and hold the funds). Once linked, the keys are used to identify your collator node. Your collator address will receive the permit to build blocks, but the session keys pass this permit to your node. </p>
<p><strong>Author Session Keys</strong>
In order to obtain the session keys, SSH to your node and run the below <code>curl</code> command:</p>
<pre><code class="language-bash">curl -H &quot;Content-Type: application/json&quot; -d '{&quot;id&quot;:1, &quot;jsonrpc&quot;:&quot;2.0&quot;, &quot;method&quot;: &quot;author_rotateKeys&quot;, &quot;params&quot;:[]}' http://localhost:9944
</code></pre>
<p>The result will look like this (you just need to copy the key):</p>
<pre><code class="language-bash">{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;result&quot;:&quot;0x600e6cea49bdeaab301e9e03215c0bcebab3cafa608fe3b8fb6b07a820386048&quot;,&quot;id&quot;:1}
</code></pre>
<p>You can access to the private key generated in this process by reaching the file generated under <code>chains/&lt;chain-name&gt;/keystore</code>.</p>
<p><strong>Set Session Keys</strong>
Go to the Polkadot.js portal and connect to respective network (e.g. Rococo-AssetHub).
Go to Developper &gt; Extrinsic and select your collator account and extrinsic type: session / setKeys
In the <code>Keys</code> section paste your session key obtained from the curl command and in the <code>proof</code> section enter <code>0x</code>.  Finally submit the call.</p>
<p>Note: The proof depends on the session key. For instance if your session key was started with <code>00x</code> the proof would be <code>00x</code>.</p>
<h2 id="4--bond-funds"><a class="header" href="#4--bond-funds">4- Bond Funds</a></h2>
<p>Dependig on the parachain, you need a minimum amount of funds to be able to start authoring the blocks.
Go to the Polkadot.js portal: Developer &gt; Extrinsics
Select your collator account and extrinsic type: CollatorSelection / registerAsCandidate
and finally submit the transaction.</p>
<p><strong>Congratulations!</strong>
If you have followed all of these steps, and been selected to be a part of the collator set, you are now running a collator!
Once your collator is active, you will see your name inside Network tab every time you produce a block:</p>
<h1 id="kubernetes"><a class="header" href="#kubernetes">Kubernetes</a></h1>
<p>If you wish to run the collator on kubernetes environment, there's already a node helm-chart developed by parity that supports collators.</p>
<h4 id="add-node-helm-chart-repo"><a class="header" href="#add-node-helm-chart-repo">Add Node Helm Chart Repo</a></h4>
<pre><code class="language-bash">helm repo add parity https://paritytech.github.io/helm-charts/
helm -n NAMESPACE upgrade --install RELEASE_NAME -f FILE_NAME.yml parity/node
</code></pre>
<h4 id="install-the-node-helm-chart"><a class="header" href="#install-the-node-helm-chart">Install the node helm chart</a></h4>
<p>Here's an example values file that will be needed to properly deploy the parachain:</p>
<pre><code class="language-bash">node:
  image:
    repository: parity/polkadot-parachain
    tag: 1.14.0 
  node:
    chain: asset-hub-polkadot
    command: polkadot-parachain
    replicas: 2
    role: collator
    chainData:
      database: paritydb
      volumeSize: 100Gi
      storageClass: ssd-csi
      pruning: 1000
    chainKeystore:
      mountInMemory:
        enabled: true
    isParachain: true
    collatorRelayChain:
      chain: polkadot
      chainData:
        database: paritydb
        pruning: 256
        storageClass: ssd-csi
        volumeSize: 200Gi
        chainSnapshot:
          enabled: true
          method: http-filelist
          url: https://snapshots.polkadot.io/polkadot-paritydb-prune
        chainPath: polkadot
      chainKeystore:
        mountInMemory:
          enabled: true
    perNodeServices:
      relayP2pService:
        enabled: true
      paraP2pService:
        enabled: true
        port: 30333
      apiService:
        enabled: true
        type: ClusterIP
      setPublicAddressToExternalIp:
        enabled: true
</code></pre>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="parachain-production-readiness-checklist"><a class="header" href="#parachain-production-readiness-checklist">Parachain Production Readiness Checklist</a></h1>
<p>Before launching your parachain network, verify the readiness of your network infrastructure by reviewing the following five key points.</p>
<!-- toc -->
<ul>
<li><a href="guides/readiness-checklist.html#1-launch-your-parachain-on-a-testnet-before-launching-on-mainnet">1. Launch your parachain on a testnet before launching on mainnet</a></li>
<li><a href="guides/readiness-checklist.html#2-use-infrastructure-as-code">2. Use Infrastructure as Code</a></li>
<li><a href="guides/readiness-checklist.html#3-ensure-redundancy-for-your-network-nodes">3. Ensure redundancy for your network nodes</a></li>
<li><a href="guides/readiness-checklist.html#4-check-that-your-nodes-are-properly-configured-to-fulfil-their-roles">4. Check that your nodes are properly configured to fulfil their roles</a>
<ul>
<li><a href="guides/readiness-checklist.html#chainspec-checks">Chainspec checks</a></li>
<li><a href="guides/readiness-checklist.html#bootnode-checks">Bootnode checks</a></li>
<li><a href="guides/readiness-checklist.html#collator-checks">Collator checks</a></li>
<li><a href="guides/readiness-checklist.html#rpc-checks">RPC checks</a></li>
</ul>
</li>
<li><a href="guides/readiness-checklist.html#5-validate-that-your-nodes-are-fully-synced">5. Validate that your nodes are fully synced</a></li>
<li><a href="guides/readiness-checklist.html#6-set-up-monitoring-and-alerting">6. Set up monitoring and alerting</a></li>
</ul>
<ul>
<li><a href="guides/readiness-checklist.html#tips">Tips:</a></li>
</ul>
<!-- tocstop -->
<h2 id="1-launch-your-parachain-on-a-testnet-before-launching-on-mainnet"><a class="header" href="#1-launch-your-parachain-on-a-testnet-before-launching-on-mainnet">1. Launch your parachain on a testnet before launching on mainnet</a></h2>
<p>The best way to validate your deployment is to deploy a testnet for your parachain.
The recommended relay-chain testnet for builders is now <a href="https://github.com/paseo-network">Paseo</a> where you can benefit from a stable and mainnet-like experience before onboarding to Polkadot.</p>
<h2 id="2-set-up-your-nodes-using-infrastructure-as-code"><a class="header" href="#2-set-up-your-nodes-using-infrastructure-as-code">2. Set up your nodes using Infrastructure as Code</a></h2>
<p>Using Infrastructure as Code for your blockchain nodes helps with the following:</p>
<ul>
<li><strong>Consistency and Reproducibility</strong>: Reduces manual configurations and allows configuration reuse across testnet and mainnet.</li>
<li><strong>Automation and Efficiency</strong>: Although it takes upfront work to set up, you will speed up further deployments by reducing the number of manual steps.</li>
<li><strong>Disaster Recovery</strong>: In the event of a disaster, you will be able to quickly restore your infrastructure.</li>
</ul>
<h2 id="3-ensure-redundancy-for-your-network-nodes"><a class="header" href="#3-ensure-redundancy-for-your-network-nodes">3. Ensure redundancy for your network nodes</a></h2>
<p>For a reliable network, it is recommended to have at least:</p>
<ul>
<li>2 Bootnodes</li>
<li>2 Collators</li>
<li>2 RPC nodes behind a load balancer</li>
</ul>
<p>This will help ensure the smooth operation of the network, allowing one node to restart or upgrade while the other still performs its function.
After launch, it is a good idea to increase the size of the network further and decentralize node operations to multiple individuals and organizations.</p>
<h2 id="4-check-that-your-nodes-are-properly-configured-to-fulfil-their-roles"><a class="header" href="#4-check-that-your-nodes-are-properly-configured-to-fulfil-their-roles">4. Check that your nodes are properly configured to fulfil their roles</a></h2>
<h3 id="chainspec-checks"><a class="header" href="#chainspec-checks">Chainspec checks</a></h3>
<p>Your chainspec must:</p>
<ul>
<li>Have all the required properties such as <code>para_id</code> and <code>relay_chain</code></li>
<li>Be <a href="guides/./parachain_deployment.html#convert-your-plain-chainspec-to-raw">converted to raw format</a></li>
<li>Have the desired chain state in <a href="guides/./parachain_deployment.html#optional-dry-run-your-parachain-network-locally">its genesis block viewable in a local parachain dry-run</a></li>
<li>Reference your bootnodes addresses so your nodes will connect to the correct network on startup</li>
</ul>
<h3 id="bootnode-checks"><a class="header" href="#bootnode-checks">Bootnode checks</a></h3>
<p>Your bootnodes must have a fixed network ID and fixed IP or DNS in their addresses, e.g., /dns/polkadot-bootnode-0.polkadot.io/tcp/30333/p2p/12D3KooWSz8r2WyCdsfWHgPyvD8GKQdJ1UAiRmrcrs8sQB3fe2KU.
This can be achieved with these flags, e.g:</p>
<pre><code>--node-key-file &lt;key-file&gt; --listen-addr=/ip4/0.0.0.0/tcp/30333 --listen-addr /ip6/::/tcp/30333 --public-addr=/ip4/PUBLIC_IP/tcp/30333.
</code></pre>
<p>⚠️ Your bootnodes should always keep the same addresses across restarts.</p>
<h3 id="collator-checks"><a class="header" href="#collator-checks">Collator checks</a></h3>
<ul>
<li>Each of your collators must have an aura key in their keystore, as explained in the [collator guide](TODO link to collator guide)</li>
<li>The aura keys also need to be set on-chain, either:
<ul>
<li>in the <a href="guides/./parachain_deployment.html#prepare-your-genesis-patch-config">genesis state directly in the chainspec file</a></li>
<li>by [submitting a setKeys extrinsic with your collator account](TODO link to collator guide)</li>
</ul>
</li>
</ul>
<h3 id="rpc-checks"><a class="header" href="#rpc-checks">RPC checks</a></h3>
<p>Your RPC nodes should have those flags enabled:</p>
<ul>
<li><code>--rpc-external</code> or <code>--unsafe-rpc-external</code> (does the same but doesn't output a warn log)</li>
<li><code>--rpc-methods Safe</code></li>
<li><code>--rpc-cors *</code></li>
<li><code>--pruning=archive</code>, you generally want to have your RPC nodes to be archives to access historical blocks.</li>
</ul>
<p>You can also add RPC protections flags, e.g.:</p>
<ul>
<li><code>--rpc-max-connections 1000</code>: Allow a maximum of 1000 simultaneous open connection</li>
<li><code>--rpc-rate-limit=10</code>: Limit to 10 calls per minute</li>
<li><code>--rpc-rate-limit-whitelisted-ips 10.0.0.0/8 1.2.3.4/32</code>: Disable RPC rate limiting for certain ip addresses</li>
<li><code>--rpc-rate-limit-trust-proxy-headers</code>: Trust proxy headers for determining the IP for rate limiting</li>
</ul>
<h2 id="5-validate-that-your-nodes-are-fully-synced"><a class="header" href="#5-validate-that-your-nodes-are-fully-synced">5. Validate that your nodes are fully synced</a></h2>
<p>Your parachain nodes should be fully synced with the latest blocks of both your parachain and the relay-chain it is connected to.</p>
<h2 id="6-set-up-monitoring-and-alerting"><a class="header" href="#6-set-up-monitoring-and-alerting">6. Set up monitoring and alerting</a></h2>
<p>At a minimum, it is recommended to collect your nodes logs and be notified whenever an error or panic logs happens.</p>
<p>It is highly recommended to set up metrics based monitoring and alerting, including:</p>
<ul>
<li>General system-level metrics, e.g. by using the <a href="https://awesome-prometheus-alerts.grep.to/rules.html#host-and-hardware">prometheus node exporter</a> to watch over disk, cpu, memory, oom kills, etc.</li>
<li><a href="guides/../monitoring/infrastructure.html#metrics">Polkadot-sdk native metrics</a></li>
</ul>
<h1 id="tips"><a class="header" href="#tips">Tips:</a></h1>
<ul>
<li>For troubleshooting testnets collators you can set<code>--log parachain=debug</code>.
Other useful debug targets are<code>runtime=debug</code>, <code>sync=debug</code>, <code>author=debug</code>, <code>xcm=debug</code>, etc.</li>
<li>You should avoid setting trace logging on all your nodes; if you do, set it on a limited number of nodes where it is useful and remove it when not needed anymore.</li>
</ul>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="explanations"><a class="header" href="#explanations">Explanations</a></h1>
<h2 id="general-approach-to-infrastructure"><a class="header" href="#general-approach-to-infrastructure">General Approach to Infrastructure</a></h2>
<p>It is highly recommended that projects deploying networks have an infrastructure as code mindset. The infrastructure components in deployments should be written in code and put in a version control system.</p>
<p>This ensures that:</p>
<ul>
<li>Your Infrastructure is in a known state</li>
<li>Version control is available to see changes and enforce reviews etc...</li>
<li>Rolling back is made very easy</li>
<li>There are no manual actions required to redeploy</li>
</ul>
<p><img src="explanations/../images/3osxC7.png" alt="workflow" /></p>
<h2 id="general-approach-to-security"><a class="header" href="#general-approach-to-security">General Approach to Security</a></h2>
<p>One of the main desired properties of a blockchain is security, so having a very ‘secure by default’ approach to your infrastructure should always be in the forefront of your mind when deploying new networks.</p>
<p>On the infrastructure side, having strict rules and blocking any non-required communication is just a starting point. Other things that should be considered are things like log monitoring, bastion hosts being required for access, 2FA for ssh etc…</p>
<p>On the chain operations side, there are two very useful concepts to increase your security.</p>
<p>First is using cold / warm / hot keys, so that the compromise of say a session key would not lead to any funds being stolen. Also using multisig accounts on offline devices can greatly help security and also give an on-chain audit trail of all actions, allows for alerting for any onchain actions etc...</p>
<p><img src="explanations/../images/AEEVr6.png" alt="key stages" /></p>
<p>Proxy accounts also let you limit the permission that an account or multisig account has on a particular target account (e.g. only staking functions can be executed by the staking controller multisig account and require 3 of 5 people to approve).</p>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="deployments"><a class="header" href="#deployments">Deployments</a></h1>
<p>This section describes the various types of deployments and options used for each.</p>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="blockchain-node-roles"><a class="header" href="#blockchain-node-roles">Blockchain Node Roles</a></h1>
<p>A non exhaustive list of some common roles assumed by nodes:</p>
<table><thead><tr><th>Role</th><th>Description</th></tr></thead><tbody>
<tr><td>Validator</td><td>Secures the Relay Chain by staking DOT, validating proofs from collators on parachains and voting on consensus along with other validators.</td></tr>
<tr><td>Collator</td><td>Maintains a parachain by collecting parachain transactions and producing state transition proofs for the validators.</td></tr>
<tr><td>Bootnode</td><td>A node with a static address and p2p public key, used to bootstrap a node onto the network’s distributed hash table and find peers.</td></tr>
<tr><td>RPC Node</td><td>Expose an RPC interface over http or websocket for the relay chain or parachain and allow users to read the blockchain state and submit transactions (extrinsics). There are often multiple RPC nodes behind a load balancer.</td></tr>
</tbody></table>
<p>Additionally, we also usually distinguish types of nodes:</p>
<table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>Full Node</td><td>A node which is syncing the relay chain or parachain to the current best block. It can make use of database pruning to reduce its disk usage.</td></tr>
<tr><td>Archive Node</td><td>A full node which has a complete database starting all the way from the genesis block.</td></tr>
<tr><td>Light Node</td><td>Also called light client, can connect to a chain network but does not require to have full copy of the entire blockchain</td></tr>
</tbody></table>
<h2 id="simplified-diagram-of-the-parachain-network-architecture"><a class="header" href="#simplified-diagram-of-the-parachain-network-architecture">Simplified Diagram of the Parachain Network architecture</a></h2>
<p>The diagram below illustrate how different nodes play different roles in the network by having different configuration.</p>
<p><img src="deployments/./parachain-node-diagram.drawio.svg" alt="parachain node diagram" /></p>
<ul>
<li>Bootnodes expose their P2P port behind an easy to find IP or DNS address.</li>
<li>RPC nodes expose their RPC endpoint publicly.</li>
<li>Collators sign blocks and propose them for validation to the Relaychain validators</li>
<li>We can adjust the database pruning (archive or pruned) depending on the node role.</li>
</ul>
<h2 id="downsides-of-deploying-nodes-without-clear-role-separation"><a class="header" href="#downsides-of-deploying-nodes-without-clear-role-separation">Downsides of deploying nodes without clear role separation</a></h2>
<p>Although, it is possible for a single node to assume multiple roles (collator, RPC, bootnode), robust network deployments are composed of multiple nodes of each types to ensure reliability.</p>
<p>For example, if a collator node also serves as an RPC node, receiving increased user traffic might overload the node and bring down block production. To prevent this from happening, it is possible to set up several dedicated RPC nodes behind a load balancer. Similarly, setting up additional collators in your network will allows downtime of fraction of the collator set without slowing down block production.</p>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="deployment-targets"><a class="header" href="#deployment-targets">Deployment Targets</a></h1>
<p>A non-exhaustive list of some common deployment targets:</p>
<table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>Physical Server</td><td>Usually a rack mounted server sitting in a data center.</td></tr>
<tr><td>Virtual Machine</td><td>A virtual machine hosted by one of many cloud providers or self-hosted onsite.</td></tr>
<tr><td>Kubernetes</td><td>A container orchestration engine to host your blockchain instances. This option is only recommended if you already have prior experience with Kubernetes, especially in production environments.</td></tr>
<tr><td>Local Container</td><td>An instance running on a local container engine (e.g. containerd, docker, Podman).</td></tr>
</tbody></table>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="special-options-per-host-type"><a class="header" href="#special-options-per-host-type">Special Options Per Host Type</a></h1>
<table><thead><tr><th>Type</th><th>Function</th></tr></thead><tbody>
<tr><td>Validator</td><td>Should at least be running with the <code>--validator</code> flag to enable block validation. Also keys should have been injected or the RPC <code>author_rotateKeys</code> called.</td></tr>
<tr><td>Collator</td><td>Should at least be running with the <code>--collator</code> flag to enable parachain collation.</td></tr>
<tr><td>Bootnode</td><td>A node with a static key file so the p2p public address is always the same. Store this private key in a file and use the option: <code>--node-key-file /path/to/file</code></td></tr>
<tr><td>RPC Node</td><td>Use these options to allow 5000 public RPC/WS connections: <code>--unsafe-ws-external --rpc-methods Safe --rpc-cors ‘*’  --ws-max-connections 5000</code></td></tr>
<tr><td>Archive Node</td><td>Use <code>-–pruning=archive</code> to not prune any block history</td></tr>
<tr><td>Full Node</td><td>N/A</td></tr>
</tbody></table>
<h2 id="parachain-specifics"><a class="header" href="#parachain-specifics">Parachain Specifics</a></h2>
<p>When running a parachain then you will need two sets of arguments, one for the relay chain and one for the parachain. Used in the format:</p>
<pre><code class="language-bash">./statemine $PARACHAIN_OPTIONS -- $RELAYCHAIN_OPTIONS
</code></pre>
<p>A real life example of this while executing as a statemine collator would be:</p>
<pre><code class="language-bash">./statemine  --chain statemine --in-peers 25 --out-peers 25 --db-cache 512 --pruning=1000 --unsafe-pruning -- --chain kusama -db-cache 512 --pruning=1000 --wasm-execution Compiled
</code></pre>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="server-deployments"><a class="header" href="#server-deployments">Server Deployments</a></h1>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="systemd"><a class="header" href="#systemd">Systemd</a></h1>
<h2 id="overview-1"><a class="header" href="#overview-1">Overview</a></h2>
<p>Systemd is a common way to manage services on Linux hosts. It can ensure the process is enabled and running, allows you to set a policy for restarts and also set the user running the host, limit the memory usage etc...</p>
<p>It can also use an environment variable file which can help abstract the variables into its own file per server.</p>
<h2 id="simple-example"><a class="header" href="#simple-example">Simple Example</a></h2>
<p>A simple example running a local dev chain as Alice, assuming the username is called polkadot would look like:</p>
<pre><code class="language-yaml">[Unit]
Description=Polkadot Validator

[Service]
User=polkadot
ExecStart=/home/polkadot/polkadot  --dev --alice
Restart=always
RestartSec=90

[Install]
WantedBy=multi-user.target
</code></pre>
<p>This file should be placed in /etc/systemd/system/polkadot.service and then enabled with <code>systemctl enable polkadot</code> then <code>systemctl start polkadot</code> to start the service.</p>
<h2 id="using-environment-variable-files"><a class="header" href="#using-environment-variable-files">Using Environment Variable Files</a></h2>
<p>If we want to remove some options from the systemd file itself (e.g. <code>--dev --alice</code>) and put them in an environment variable file then the systemd service would now look like:</p>
<pre><code class="language-yaml">[Unit]
Description=Polkadot Validator

[Service]
User=polkadot
EnvironmentFile=/etc/default/polkadot
ExecStart=/home/polkadot/polkadot  $START_OPTIONS
Restart=always
RestartSec=90

[Install]
WantedBy=multi-user.target
</code></pre>
<p>Then you would need to create a file in /etc/default/polkadot which looks like:</p>
<pre><code class="language-bash">START_OPTIONS=&quot;--dev --alice&quot;
</code></pre>
<p>You can do this with multiple variables to abstract the configuration from the systemd file running on your hosts.</p>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="logging"><a class="header" href="#logging">Logging</a></h1>
<h2 id="local-logging"><a class="header" href="#local-logging">Local Logging</a></h2>
<p>By default, output from your systemd service will go to local syslog. This will mean it ends up in a place like <code>/var/log/syslog</code> or <code>/var/log/messages</code></p>
<p>You can also view these using the <code>journalctl</code> command. To tail the current output of the polkadot process run:</p>
<pre><code class="language-bash">journalctl -u polkadot -f
</code></pre>
<p>It is also possible to remove old logs (say older than two days ago) using a command:</p>
<pre><code class="language-bash">journalctl -u polkadot --vacuum-time=2d
</code></pre>
<p>Or to retain only the past 1G of data run:</p>
<pre><code class="language-bash">journalctl --vacuum-size=1G
</code></pre>
<h2 id="remote-logging"><a class="header" href="#remote-logging">Remote Logging</a></h2>
<p>In a setup with many hosts you will want to aggregate the logs at a central point, some common options include Loki or Elasticsearch.</p>
<h3 id="loki"><a class="header" href="#loki">Loki</a></h3>
<p>To log to a remote Loki instance you need to install the <code>promtail</code> package. An example configuration file to send logs to a remote host:</p>
<pre><code class="language-yaml"># promtail server config
server:
  http_listen_port: 9080
  grpc_listen_port: 0
  log_level: info
positions:
  filename: /var/lib/promtail/positions.yaml

# loki servers
clients:
  - url: http://myloki.mycompany.com/loki/api/v1/push
    backoff_config:
      min_period: 1m
      max_period: 1h
      max_retries: 10000
scrape_configs:
  - job_name: journald
    journal:
      max_age: 1m
      path: /var/log/journal
      labels:
        job: journald
    pipeline_stages:
      - match:
          selector: '{job=&quot;journald&quot;}'
          stages:
            - multiline:
                firstline: '^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3}'
                max_lines: 2500
            - regex:
                expression: '(?P&lt;date&gt;\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3})\s+(?P&lt;level&gt;(TRACE|DEBUG|INFO|WARN|ERROR))\s+(?P&lt;worker&gt;([^\s]+))\s+(?P&lt;target&gt;[\w-]+):?:?(?P&lt;subtarget&gt;[\w-]+)?:[\s]?(?P&lt;chaintype&gt;\[[\w-]+\]+)?[\s]?(?P&lt;message&gt;.+)'
            - labels:
                level:
                target:
                subtarget:
</code></pre>
<h3 id="elasticsearch"><a class="header" href="#elasticsearch">Elasticsearch</a></h3>
<p>To log to a remote Elasticsearch cluster you need to install the <code>logstash</code> package. An example configuration would look like:</p>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
<pre><code class="language-json">input {
  journald {
    path      =&gt; &quot;/var/log/journal&quot;
    seekto =&gt; &quot;tail&quot;
    thisboot =&gt; true
    filter    =&gt; {
      &quot;_SYSTEMD_UNIT&quot; =&gt; &quot;polkadot.service&quot;
    }
    type =&gt; &quot;systemd&quot;
  }
=======

```yaml
input {
     journald {
       path      =&gt; &quot;/var/log/journal&quot;
       seekto =&gt; &quot;tail&quot;
       thisboot =&gt; true
       filter    =&gt; {
           &quot;_SYSTEMD_UNIT&quot; =&gt; &quot;polkadot.service&quot;
       }
       type =&gt; &quot;systemd&quot;
     }
&gt;&gt;&gt;&gt;&gt;&gt;&gt; main
}


filter {
  date {
    match =&gt; [&quot;timestamp&quot;, &quot;YYYY-mm-dd HH:MM:ss.SSS&quot;]
    target =&gt; &quot;@timestamp&quot;
  }
  mutate {
    rename =&gt; [ &quot;MESSAGE&quot;, &quot;message&quot; ]
    remove_field =&gt; [ &quot;cursor&quot;, &quot;PRIORITY&quot;, &quot;SYSLOG_FACILITY&quot;, &quot;SYSLOG_IDENTIFIER&quot;, &quot;_BOOT_ID&quot;, &quot;_CAP_EFFECTIVE&quot;, &quot;_CMDLINE&quot;, &quot;_COMM&quot;, &quot;_EXE&quot;, &quot;_GID&quot;, &quot;_HOSTNAME&quot;, &quot;_MACHINE_ID&quot;, &quot;_PID&quot;, &quot;_SELINUX_CONTEXT&quot;, &quot;_STREAM_ID&quot;, &quot;_SYSTEMD_CGROUP&quot;, &quot;_SYSTEMD_INVOCATION_ID&quot;, &quot;_SYSTEMD_SLICE&quot;, &quot;_SYSTEMD_UNIT&quot;, &quot;_TRANSPORT&quot;, &quot;_UID&quot; ]
  }
  if ([message] =~ &quot;.*TRACE .*&quot;) { drop{ } }
  grok {
    match =&gt; { &quot;message&quot; =&gt; &quot;%{NOTSPACE:thread} %{LOGLEVEL:log-level} %{NOTSPACE:namespace} %{GREEDYDATA:message}&quot; }
  }
}

output {
  elasticsearch {
    hosts =&gt; [&quot;https://myelasticsearch.mycompany.com:9243&quot;]
    user =&gt; &quot;username&quot;
    password =&gt; &quot;password&quot;
    index =&gt; &quot;logstash-polkadot-%{+YYYY.MM.dd}&quot;
  }
}
</code></pre>
<h2 id="logging-options"><a class="header" href="#logging-options">Logging Options</a></h2>
<p>Logging output from any substrate based changes has many log levels and targets. All targets are set to <code>info</code> logging by default. You can adjust individual log levels using the <code>--log (-l short)</code> option, for example <code>-l afg=trace,sync=debug</code> or globally with <code>-ldebug</code>.</p>
<p>Levels:</p>
<ul>
<li>error</li>
<li>warn</li>
<li>info</li>
<li>debug</li>
<li>trace</li>
</ul>
<p>Targets:</p>
<ul>
<li>afg</li>
<li>aura</li>
<li>babe</li>
<li>beefy</li>
<li>db</li>
<li>gossip</li>
<li>header</li>
<li>peerset</li>
<li>pow</li>
<li>rpc</li>
<li>runtime</li>
<li>runtime::contracts</li>
<li>sc_offchain</li>
<li>slots</li>
<li>state-db</li>
<li>state_tracing</li>
<li>sub-libp2p</li>
<li>sync</li>
<li>telemetry</li>
<li>tracing</li>
<li>trie</li>
<li>txpool</li>
</ul>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="automation"><a class="header" href="#automation">Automation</a></h1>
<h2 id="cloud-provisioning"><a class="header" href="#cloud-provisioning">Cloud Provisioning</a></h2>
<p>There are multiple options to provision cloud resources, which can either be provider specific and some tools are more cloud-agnostic.</p>
<h3 id="popular-cloud-provider-specific-deployment-tooling"><a class="header" href="#popular-cloud-provider-specific-deployment-tooling">Popular Cloud Provider Specific Deployment Tooling</a></h3>
<ul>
<li><a href="https://aws.amazon.com/cloudformation/">Amazon Cloud Formation</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/overview">Azure Resource Manager</a></li>
<li><a href="https://cloud.google.com/deployment-manager/docs">Google Cloud Deployment</a></li>
</ul>
<p>These vendor specific deployment tools are easy to use, have great examples and support. However, when using multiple providers with custom scripting formats, making a basic to your infrastructure can require changes to multiple sections of code, for each provider to do the same thing (e.g. open a port on a host).</p>
<p>A more general solution where a change can be specified once and be used with multiple providers is using Terraform. Which currently has <a href="https://registry.terraform.io/browse/providers">more than</a> 2000 providers supported.</p>
<h2 id="terraform"><a class="header" href="#terraform">Terraform</a></h2>
<p><a href="https://www.terraform.io/">Terraform</a> is a very commonly used tool for creating all sorts of cloud resources. It supports many different providers along with having excellent modules for the main three providers (AWS, Azure, GCP). Many projects rely on this for their infrastructure deployments.</p>
<p>It uses HashiCorp’s <a href="https://www.terraform.io/language">HashiCorp Configuration Language</a>, which makes it very easy to abstract configuration, avoid the reuse of code and enables you to plug modules together easily (e.g. RPC nodes along with a frontend load balancer).</p>
<p>The code is also easy to read and should be in version control. Multiple environments can be defined, so you can ensure you are using the same code on dev / test / production.</p>
<p>Two ways to preconfigure your host after deployment using terraform directly is to either:</p>
<ul>
<li>Use a pre-packaged image with all of your software (e.g. packer or similar tooling)</li>
<li>Use a cloud-init script to execute a certain script to preconfigure your base image</li>
</ul>
<p>Some examples of using terraform with multiple providers can be found in the W3F’s polkadot-validator-setup GitHub repo.</p>
<p>Click here for a list of <a href="https://registry.terraform.io/browse/providers">terraform providers</a>.</p>
<h3 id="host-maintenance"><a class="header" href="#host-maintenance">Host Maintenance</a></h3>
<p>Once your hosts are deployed you will need to configure the hosts and install the required software, configuration files etc… As mentioned this can be done in a few ways using terraform itself, however another very flexible way of configuring hosts is using Ansible.</p>
<table><thead><tr><th>Component</th><th>Description</th></tr></thead><tbody>
<tr><td>Playbook</td><td>Playbooks are the language by which Ansible orchestrates, configures, administers, or deploys systems</td></tr>
<tr><td>Role</td><td>Roles are units of organization in Ansible. Assigning a role to a group of hosts (or a set of groups, or host patterns, and so on) implies that they should implement a specific behavior</td></tr>
</tbody></table>
<p>When deploying our blockchain nodes, we will need an inventory which contains a list of our hosts and the groups they are in (e.g. validator, collator, rpc) and maybe some secrets which can be encrypted inline within the inventory using <a href="https://docs.ansible.com/ansible/latest/user_guide/vault.html">Ansible vault</a>. We will then call a playbook which links hosts/groups in the inventory with roles to execute on each host.</p>
<p>Some examples of using Ansible can be found in the Paritytech's <a href="https://github.com/paritytech/ansible-galaxy">Ansible Galaxy</a> GitHub repo. Specifically the node role.</p>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="kubernetes-1"><a class="header" href="#kubernetes-1">Kubernetes</a></h1>
<p>As previously mentioned, Kubernetes deployments are only recommended for people with good prior operating experience of Kubernetes.</p>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="helm-chart"><a class="header" href="#helm-chart">Helm Chart</a></h1>
<h2 id="overview-2"><a class="header" href="#overview-2">Overview</a></h2>
<p>Parity maintains a helm GitHub repo @ <a href="https://github.com/paritytech/helm-charts">https://github.com/paritytech/helm-charts</a> - Inside this repo is the <a href="https://github.com/paritytech/helm-charts/tree/main/charts/node">node</a> chart which should be used for deploying your Substrate/Polkadot binary.</p>
<p>All variables are documented clearly in the <a href="https://github.com/paritytech/helm-charts/blob/main/charts/node/README.md">README.md</a> and there’s an example <a href="https://github.com/paritytech/helm-charts/tree/main/charts/node/examples/local-rococo">local-rococo</a> which you can start working from.</p>
<h3 id="example-rococo-local-chain"><a class="header" href="#example-rococo-local-chain">Example Rococo Local Chain</a></h3>
<p>This is a simple example of deploying a <code>rococo-local</code> test chain in Kubernetes. Two validators and two full nodes will be deployed via the helm chart. Once both validators are running you will see block production. A custom node key is used on the <code>Alice</code> validator which all other hosts use as a bootnode.</p>
<h4 id="first-install-the-helm-repo"><a class="header" href="#first-install-the-helm-repo">First install the helm repo</a></h4>
<pre><code class="language-bash">helm repo add parity https://paritytech.github.io/helm-charts/
</code></pre>
<h4 id="deploy-validator-alice"><a class="header" href="#deploy-validator-alice">Deploy Validator Alice</a></h4>
<p>Alice will be deployed in a stateful set and use an example custom node key, along with deploying a service to be used as a bootnode:</p>
<pre><code class="language-bash">helm install rococo-alice parity/node --set node.role=&quot;validator&quot; --set node.customNodeKey=&quot;91cb59d86820419075b08e3043cd802ba3506388d8b161d2d4acd203af5194c1&quot; --set node.chain=rococo-local --set node.perNodeServices.relayP2pService.enabled=true --set node.perNodeServices.relayP2pService.port=30333 --set node.flags=&quot;--alice --rpc-external --ws-external --rpc-cors all --rpc-methods=unsafe&quot;
</code></pre>
<h4 id="deploy-validator-bob"><a class="header" href="#deploy-validator-bob">Deploy Validator Bob</a></h4>
<pre><code class="language-bash">helm install rococo-bob parity/node --set node.role=&quot;validator&quot; --set node.chain=rococo-local --set node.flags=&quot;--bob --bootnodes '/dns4/rococo-alice-node-0-relay-chain-p2p/tcp/30333/p2p/12D3KooWMeR4iQLRBNq87ViDf9W7f6cc9ydAPJgmq48rAH116WoC'&quot;
</code></pre>
<h4 id="deploy-two-full-nodes"><a class="header" href="#deploy-two-full-nodes">Deploy Two Full Nodes</a></h4>
<pre><code class="language-bash">helm install rococo-pool parity/node --set node.chain=rococo-local --set node.replicas=2 --set node.flags=&quot;--bootnodes '/dns4/rococo-alice-node-0-relay-chain-p2p/tcp/30333/p2p/12D3KooWMeR4iQLRBNq87ViDf9W7f6cc9ydAPJgmq48rAH116WoC'&quot;
</code></pre>
<p>Once these steps are complete you will have a working <code>rococo-local</code> test chain with two validators and two full nodes.</p>
<h4 id="gitops-tooling"><a class="header" href="#gitops-tooling">GitOps Tooling</a></h4>
<p>Below are some useful GitOps tool for managing helm releases. Here is a list of tool from simplest to more advanced:</p>
<ul>
<li><a href="https://github.com/roboll/helmfile">Helmfile</a></li>
<li><a href="https://registry.terraform.io/providers/hashicorp/helm/latest/docs">Terraform Helm provider</a></li>
<li><a href="https://fluxcd.io/">Flux CD</a></li>
<li><a href="https://argo-cd.readthedocs.io/en/stable/">ArgoCD</a></li>
</ul>
<h2 id="important-chart-options"><a class="header" href="#important-chart-options">Important Chart Options</a></h2>
<table><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody>
<tr><td>node.chain</td><td>Network to connect to</td></tr>
<tr><td>node.command</td><td>Binary to use</td></tr>
<tr><td>node.flags</td><td>Flags to use with binary in container</td></tr>
<tr><td>node.customChainspecUrl</td><td>Custom Chainspec URL</td></tr>
</tbody></table>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="polkadot-key-injection"><a class="header" href="#polkadot-key-injection">Polkadot Key Injection</a></h1>
<h2 id="chart-settings"><a class="header" href="#chart-settings">Chart Settings:</a></h2>
<p>Ensure <code>allowUnsafeRpcMethods: true</code> is set in the helm chart values.</p>
<h2 id="example-key-injection-values"><a class="header" href="#example-key-injection-values">Example Key Injection Values:</a></h2>
<p>Add example keys, in this case <code>//Testing/babe</code> (sr25519) and <code>//Testing//gran</code> (ed25519) on chain <code>polkadot-dev</code>:</p>
<pre><code>  keys: 
    - type: &quot;gran&quot;
      scheme: &quot;ed25519&quot;
      seed: &quot;//Testing//gran&quot;
    - type: &quot;babe&quot;
      scheme: &quot;sr25519&quot;
      seed: &quot;//Testing&quot;
      extraDerivation: //babe
</code></pre>
<h2 id="get-public-keys"><a class="header" href="#get-public-keys">Get public keys:</a></h2>
<pre><code> $ polkadot key inspect //Testing//babe --network polkadot
 Secret Key URI `//Testing//babe` is account:
  Network ID:        polkadot 
 Secret seed:       0x35993b5ca38b5909a26dbc15b736dede3bdf233ce63380f6ae62cb0ca096483b
  Public key (hex):  0x28c63dd7bb87238daf363a539da87d3c67d66a199e24f7751432e4f2363e8147
  Account ID:        0x28c63dd7bb87238daf363a539da87d3c67d66a199e24f7751432e4f2363e8147
  Public key (SS58): 1vToiVGY8q2kuG5XaN4JXrydgmkvoNMPpbwb9fPU8uQuRM5
  SS58 Address:      1vToiVGY8q2kuG5XaN4JXrydgmkvoNMPpbwb9fPU8uQuRM5
</code></pre>
<pre><code>  $ polkadot key inspect //Testing//gran --network polkadot --scheme ed25519
  Secret Key URI `//Testing//gran` is account:
   Network ID:        polkadot
  Secret seed:       0xbfc22ae1e901dbd25057747b315481cf8a470261ea81892a9aa31be1391a0dcb
   Public key (hex):  0x7819b7ddc959b749a5da604c3a2d7d3e0097760be603d596f19d116d6207ad38
   Account ID:        0x7819b7ddc959b749a5da604c3a2d7d3e0097760be603d596f19d116d6207ad38
   Public key (SS58): 13iUPPkgWezjEpxFyfCKczLkrsBtJfwMWYhjDRwvtCKp1v3s
   SS58 Address:      13iUPPkgWezjEpxFyfCKczLkrsBtJfwMWYhjDRwvtCKp1v3s
</code></pre>
<ul>
<li>Babe key: 0x28c63dd7bb87238daf363a539da87d3c67d66a199e24f7751432e4f2363e8147</li>
<li>Grandpa Key: 0x7819b7ddc959b749a5da604c3a2d7d3e0097760be603d596f19d116d6207ad38</li>
</ul>
<h2 id="verify-keys-exist"><a class="header" href="#verify-keys-exist">Verify keys exist</a></h2>
<pre><code> $ yarn run:api rpc.author.hasKey 0x28c63dd7bb87238daf363a539da87d3c67d66a199e24f7751432e4f2363e8147 babe
   { 
      &quot;hasKey&quot;: true
   }
</code></pre>
<pre><code>   $ yarn run:api rpc.author.hasKey 0x7819b7ddc959b749a5da604c3a2d7d3e0097760be603d596f19d116d6207ad38 gran
   {
     &quot;hasKey&quot;: true
   }
</code></pre>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="testnet-manager"><a class="header" href="#testnet-manager">Testnet Manager</a></h1>
<p>The <a href="https://github.com/paritytech/testnet-manager">Testnet manager</a> (<a href="https://github.com/paritytech/helm-charts/tree/main/charts/testnet-manager">helm chart</a>) lets you dynamically control test networks via a simple UI or API. It gives you a single pane of glass to list, inspect and interact with the nodes (full nodes, validators and parachain collators) running in a given Kubernetes namespace.</p>
<h2 id="rococo-example-view"><a class="header" href="#rococo-example-view">Rococo Example View</a></h2>
<h3 id="list-parachains"><a class="header" href="#list-parachains">List Parachains</a></h3>
<p><img src="kubernetes/../images/rococo-parachains.png" alt="rococo-parachains" /></p>
<h3 id="list-parachain-collators"><a class="header" href="#list-parachain-collators">List Parachain Collators</a></h3>
<p><img src="kubernetes/../images/rococo-collators-1002.png" alt="rococo-collators-1002" /></p>
<h3 id="inspect-validator-node"><a class="header" href="#inspect-validator-node">Inspect Validator Node</a></h3>
<p><img src="kubernetes/../images/rococo-validator-a-node-0.png" alt="rococo-validator-a-node-0" /></p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<h3 id="requirements"><a class="header" href="#requirements">Requirements</a></h3>
<p>The testnet manager requires the chain Sudo seed phrase to perform management functions. Also, some chain specific variables should be defined in a configmap, this can be added to the <code>values.yaml</code>:</p>
<pre><code class="language-yaml">configmap:
  WS_ENDPOINT: &quot;ws://rococo-alice-node-0.rococo:9944&quot;
  NODE_HTTP_PATTERN: &quot;http://NODE_NAME.rococo:9933&quot;
  NODE_WS_PATTERN: &quot;ws://NODE_NAME.rococo:9944&quot;
  HEALTHY_MIN_PEER_COUNT: &quot;1&quot;
  LOG_LEVEL: DEBUG

secret:
  SUDO_SEED: &quot;0xe5be9a5092b81bca64be81d212e7f2f9eba183bb7a90954f7b76361f6edb5c0a&quot; # Alice
  VALIDATORS_ROOT_SEED: &quot;test test test test test test test test test test test test&quot;
</code></pre>
<p>Then install the testnet manager and port forward a connection using the output of <code>helm install ...</code>:</p>
<pre><code class="language-bash">helm repo add parity https://paritytech.github.io/helm-charts/
helm repo update
helm install testnet-mgr parity/testnet-manager --values values.yaml
</code></pre>
<h3 id="frontend-gui"><a class="header" href="#frontend-gui">Frontend GUI</a></h3>
<p>In the nodes section you can view all running nodes, their roles, chain, uptime, CLI arguments, and you can also view logs.</p>
<p><img src="kubernetes/../images/testnet-mgr.png" alt="testnet-mgr-frontend" /></p>
<h3 id="interact-with-api-via-frontend"><a class="header" href="#interact-with-api-via-frontend">Interact with API via Frontend</a></h3>
<p>It's possible to view the API calls and execute them via the GUI. The main functions are:</p>
<ul>
<li>Viewing nodes, validators, collators and parachains</li>
<li>Registering / deregistering validators and collators</li>
<li>Onboarding / off-boarding parachains</li>
<li>Rotating session keys</li>
</ul>
<p><img src="kubernetes/../images/testnet-mgr-api.png" alt="testnet-mgr-api" /></p>
<h3 id="examples"><a class="header" href="#examples">Examples</a></h3>
<p>Register a new validator in the <code>StatefulSet</code> called <code>rococo-val-pool</code>:</p>
<pre><code class="language-bash">curl -X 'POST' \
  'http://localhost:8080/api/register_validators?statefulset=rococo-val-pool' \
  -H 'accept: application/json' \
  -d ''
</code></pre>
<p>Onboard Parachain id 1000:</p>
<pre><code class="language-bash">curl -X 'POST' \
'http://localhost:8080/api/onboard_parachain/1000' \
-H 'accept: application/json' \
-d ''
</code></pre>
<h3 id="how-does-it-work-"><a class="header" href="#how-does-it-work-">How does it work ?</a></h3>
<p>The testnet-manager is deployed in the same Kubernetes namespaces as nodes deployed with the <a href="https://github.com/paritytech/helm-charts/tree/main/charts/node">node helm-chart</a>. As node pods deployed with the chart are tagged with the appropriate labels (e.g. chain name, para ID), the manager is able to query the Kubernetes API and list the running nodes for each network (relay-chain, parachains).</p>
<p>By combining this list of nodes with the on-chain state retrieved from RPC endpoints (e.g. list of active validators accounts), the manager can automate node key setup (by interacting directly with each node RPC endpoint) and registration (by submitting sudo extrinsics). Behind the scenes, it uses a derivation formula for generating deterministic Validator/Collator accounts addresses: &quot;${VALIDATORS_ROOT_SEED}//${node-name}&quot;.</p>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="monitoring-overview"><a class="header" href="#monitoring-overview">Monitoring Overview</a></h1>
<p>Monitoring can be categorized into two main areas:</p>
<h3 id="on-chain"><a class="header" href="#on-chain">On-chain</a></h3>
<p>This involves tracking events that occur on the blockchain. Examples include:</p>
<ul>
<li>Transactions by specific addresses</li>
<li>Changes in the validator set</li>
</ul>
<p>On-chain monitoring typically involves checking blockchain data via RPC nodes to assess values, delays, and the timing of events. It is recommended to run your own RPC servers to avoid potential issues with public RPC nodes. There are useful tools such as <a href="https://gitlab.com/Polkabot/polkabot">Polkabot</a> and <a href="https://github.com/paritytech/polkadot-basic-notification">Polkadot-Basic-Notification</a> to help with on-chain monitoring.</p>
<h3 id="on-host"><a class="header" href="#on-host">On-Host</a></h3>
<p>On-host monitoring involves tracking the individual node itself. Examples include:</p>
<ul>
<li>Current block height</li>
<li>Number of peer-to-peer (P2P) connections</li>
<li>Finality lag</li>
</ul>
<p>To monitor individual node, polkadot-sdk binary exposes metrics in a Prometheus type format at <a href="http://host:9615/metrics">http://host:9615/metrics</a>. By default, this endpoint is only exposed on the local network interface, but you can expose it on all interfaces using the <code>--prometheus-external</code> flag.</p>
<p>As the metrics provided by these endpoints don't include hosts metrics (e.g. CPU, memory, bandwidth usage), it is recommended to complement it with other tools such as <a href="https://github.com/prometheus/node_exporter">Prometheus node exporter</a> which needs to be installed on the same host.</p>
<h1 id="monitoring-stack"><a class="header" href="#monitoring-stack">Monitoring Stack</a></h1>
<h3 id="polkadot-tools"><a class="header" href="#polkadot-tools">Polkadot tools</a></h3>
<ul>
<li><a href="https://github.com/paritytech/polkadot-introspector">polkadot-introspector</a>: The Polkadot Introspector is a collection of tools for monitoring and introspection of Polkadot or other substrate-based blockchains.</li>
<li><a href="https://github.com/paritytech/substrate-telemetry">polkadot-telemetry</a>: The telemetry server is used for real time information from nodes, showing information about their name, location, current best &amp; finalized blocks, and others. It gives a useful dashboard to view the state of nodes. An example of live running Telemetry site is https://telemetry.polkadot.io/</li>
</ul>
<h3 id="non-polkadot-specific-tools"><a class="header" href="#non-polkadot-specific-tools">Non-Polkadot specific tools</a></h3>
<p>The recommended Polkadot monitoring stack consists of the following tools:</p>
<ul>
<li><a href="monitoring/./prometheus.html">Prometheus</a>: A systems and service monitoring system based on a timeseries database.</li>
<li><a href="monitoring/./grafana.html">Grafana</a>: allows you to query, visualize, and understand your metrics.</li>
<li><a href="monitoring/./alertmanager.html">Alertmanager</a>: Creates and routes alerts to the tool of your choice (Email / SMS / Telegram / PagerDuty / Slack / Matrix) based on alert rules and metrics</li>
<li><a href="monitoring/./loki.html">Loki</a> - A highly scalable log aggregation system that allows you to view and search logs from all your infrastructure in one place.</li>
</ul>
<p>For available set of Polkadot dashboards, alerts and rules are listed in <a href="https://github.com/paritytech/polkadot-monitoring-mixin">polkadot-monitoring-mixin</a> repository.</p>
<p>An example of the metric dashboard from polkadot-monitoring-mixin:</p>
<p><img src="monitoring/../images/metric_dashboard.png" alt="metric_dashboard" /></p>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h2 id="infrastructure-tools"><a class="header" href="#infrastructure-tools">Infrastructure Tools</a></h2>
<p>Prometheus, Loki, Alertmanager, and Grafana are powerful tools commonly used for monitoring and visualizing metrics and logs in a distributed system. Here, we focus on integrating these tools to effectively monitor Polkadot metrics across relay chains and parachains.</p>
<h3 id="metrics"><a class="header" href="#metrics">Metrics</a></h3>
<p><a href="https://prometheus.io/docs/introduction/overview/">Prometheus</a> is an open source solution that can be used to collect metrics from applications.
It collects metrics from configured targets endpoints at given intervals, evaluates rule expressions, displays the results, and can trigger alerts when specified conditions are observed.</p>
<h4 id="prometheus-configuration"><a class="header" href="#prometheus-configuration">Prometheus Configuration</a></h4>
<p>Targets are a list of endpoints you want to scrape. The two main exporters we care about are for 1) polkadot/substrate and 2) the node-exporter. An example of scraping these on the IP address 10.100.0.0 would be:</p>
<pre><code class="language-yaml">scrape_configs:
  - job_name: polkadot
    static_configs:
      - targets:
          - 10.100.0.0:9080    # promtail
          - 10.100.0.0:9100    # node exporter
          - 10.100.0.0:9615    # relaychain metrics
          - 10.100.0.0:9625    # parachain metrics
</code></pre>
<h3 id="logs"><a class="header" href="#logs">Logs</a></h3>
<p><a href="https://grafana.com/docs/loki/latest/">Loki</a> is an open source solution that can be used to aggregate logs from applications, allowing the operator to see errors, patterns and be able to search through the logs from all hosts very easily. An agent such as <a href="https://grafana.com/docs/loki/latest/send-data/promtail">Promtail</a> or <a href="monitoring/">Grafana Alloy</a> is used to push logs to the Loki server.</p>
<p>Example promtail.yaml configuration to collect the logs and create a Promtail metrics that aggregates each log level:</p>
<pre><code class="language-yaml"># promtail server config
server:
  http_listen_port: 9080
  grpc_listen_port: 0
  log_level: info
positions:
  filename: /var/lib/promtail/positions.yaml

# loki servers
clients:
  - url: http://loki.example.com/loki/api/v1/push
    backoff_config:
      min_period: 1m
      max_period: 1h
      max_retries: 10000

scrape_configs:
  - job_name: journald
    journal:
      max_age: 1m
      path: /var/log/journal
      labels:
        job: journald
    pipeline_stages:
      - match:
          selector: '{job=&quot;journald&quot;}'
          stages:
            - multiline:
                firstline: '^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3}'
                max_lines: 2500
            - regex:
                expression: '(?P&lt;date&gt;\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3})\s+(?P&lt;level&gt;(TRACE|DEBUG|INFO|WARN|ERROR))\s+(?P&lt;worker&gt;([^\s]+))\s+(?P&lt;target&gt;[\w-]+):?:?(?P&lt;subtarget&gt;[\w-]+)?:[\s]?(?P&lt;chaintype&gt;\[[\w-]+\]+)?[\s]?(?P&lt;message&gt;.+)'
            - labels:
                level:
                target:
                subtarget:
            - metrics:
                log_lines_total:
                  type: Counter
                  Description: &quot;Total Number of Chain Logs&quot;
                  prefix: &quot;promtail_chain_&quot;
                  max_idle_duration: 24h
                  config:
                    match_all: true
                    action: inc
      - match:
          selector: '{job=&quot;journald&quot;, level=&quot;ERROR&quot;}'
          stages:
            - multiline:
                firstline: '^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3}'
                max_lines: 2500
            - metrics:
                log_lines_total:
                  type: Counter
                  Description: &quot;Total Number of Chain Error Logs&quot;
                  prefix: &quot;promtail_chain_error_&quot;
                  max_idle_duration: 24h
                  config:
                    match_all: true
                    action: inc
      - match:
          selector: '{job=&quot;journald&quot;, level=~&quot;.+&quot;} |~ &quot;(?i)(panic)&quot;'
          stages:
            - multiline:
                firstline: '^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}\.\d{3}'
                max_lines: 2500
            - metrics:
                log_lines_total:
                  type: Counter
                  Description: &quot;Total Number of Chain Panic Logs&quot;
                  prefix: &quot;promtail_chain_panic_&quot;
                  max_idle_duration: 24h
                  config:
                    match_all: true
                    action: inc
    relabel_configs:
      - source_labels: [&quot;__journal__systemd_unit&quot;]
        target_label: &quot;unit&quot;
      - source_labels: [&quot;unit&quot;]
        regex: &quot;(.*.scope|user.*.service)&quot;
        action: drop
      - source_labels: [&quot;__journal__hostname&quot;]
        target_label: &quot;host&quot;
      - action: replace
        source_labels:
          - __journal__cmdline
          - __journal__hostname
        separator: &quot;;&quot;
        regex: &quot;.*--chain.*;(.*)&quot;
        target_label: &quot;node&quot;
        replacement: $1
</code></pre>
<p>The above example also configures the following custom metrics derived from logs <code>promtail_chain_log_lines_total</code>, <code>promtail_chain_error_log_lines_total</code> and <code>promtail_chain_panic_log_lines_total</code> to be exposed on the promtail metrics endpoint <a href="http://host:9080">http://host:9080</a>.</p>
<h3 id="alerts"><a class="header" href="#alerts">Alerts</a></h3>
<p><a href="https://prometheus.io/docs/alerting/latest/alertmanager/">Alertmanager</a> handles alerts sent by Prometheus client, and responsible for deduplicating, grouping and routing to the correct receiver such as email, PagerDuty, and other mechanisms via webhook receiver. </p>
<p>A simple alert for block production being slow would look like:</p>
<pre><code class="language-yaml">- alert: BlockProductionSlow
  annotations:
    message: 'Best block on instance {{ $labels.instance }} increases by
less than 1 per minute for more than 5 minutes.'
  expr: increase(substrate_block_height{status=&quot;best&quot;}[1m]) &lt; 1
  for: 5m
  labels:
    severity: warning
</code></pre>
<h3 id="visualization"><a class="header" href="#visualization">Visualization</a></h3>
<p><a href="https://grafana.com/docs/grafana/latest/">Grafana</a> is where you can define dashboards to show the time series information that Prometheus is collecting. You just need to ensure you add a datasource:</p>
<pre><code class="language-yaml">datasources:
  - name: &quot;Prometheus&quot;
    type: prometheus
    access: proxy
    editable: false
    orgId: 1
    url: &quot;http://prometheus.monitoring.svc.cluster.local&quot;
    version: 1
    jsonData:
      timeInterval: 30s
  - name: Loki
    type: loki
    access: proxy 
    orgId: 1
    url: http://loki:3100
    basicAuth: false
    version: 1
    editable: true
</code></pre>
<h3 id="polkadot-mixin"><a class="header" href="#polkadot-mixin">Polkadot-mixin</a></h3>
<p>Polkadot-monitoring-mixin is a set of Polkadot monitoring dashboards, alerts and rules collected based on our experience operating Polkadot Relay Chain and Parachain nodes. You can find it in this <a href="https://github.com/paritytech/polkadot-monitoring-mixin">repo</a>.</p>
<h2 id="docker-compose"><a class="header" href="#docker-compose">Docker Compose</a></h2>
<p>You can install the following components Docker Compose if you are evaluating, or developing monitoring stack for Polkadot.
The configuration files associated with these installation instructions run the monitoring stack as a single binary.</p>
<pre><code>version: &quot;3.8&quot;

networks:
  polkadot:

services:
  prometheus:
    container_name: prometheus
    image: prom/prometheus:v2.53.0
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
    ports:
      - 9090:9090
    restart: unless-stopped
    configs:
      - source: prometheus_config
        target: /etc/prometheus/prometheus.yml
    networks:
      - polkadot

  loki:
    container_name: loki
    image: grafana/loki:3.1.0
    ports:
      - &quot;3100:3100&quot;
    command: -config.file=/etc/loki/local-config.yaml
    networks:
      - polkadot

  promtail:
    container_name: promtail
    image: grafana/promtail:3.1.0
    command: -config.file=/etc/promtail/config.yml
    user: root # Required to read container logs
    ports:
      - 9080:9080
    volumes:
      - /var/lib/docker/containers:/var/lib/docker/containers
      - /var/run/docker.sock:/var/run/docker.sock
    configs:
      - source: promtail_config
        target: /etc/promtail/config.yml
    networks:
      - polkadot

  grafana:
    container_name: grafana
    image: grafana/grafana:latest
    environment:
      - GF_PATHS_PROVISIONING=/etc/grafana/provisioning
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin
    entrypoint:
      - sh
      - -euc
      - |
        mkdir -p /etc/grafana/provisioning/datasources
        cat &lt;&lt;EOF &gt; /etc/grafana/provisioning/datasources/ds.yaml
        apiVersion: 1
        datasources:
        - name: Loki
          type: loki
          access: proxy 
          orgId: 1
          url: http://loki:3100
          basicAuth: false
          version: 1
          editable: true
        - name: Prometheus
          type: prometheus
          access: proxy 
          orgId: 1
          url: http://prometheus:9090
          basicAuth: false
          isDefault: true
          version: 1
          editable: true
        EOF
        /run.sh
    ports:
      - &quot;3000:3000&quot;
    networks:
      - polkadot

  polkadot_collator:
    container_name: polkadot_collator
    image: parity/polkadot-parachain:1.14.0
    command: &gt;
      --tmp --prometheus-external --prometheus-port 9625 -- --tmp --prometheus-external --prometheus-port 9615
    ports:
      - &quot;9615:9615&quot;
      - &quot;9625:9625&quot;
    networks:
      - polkadot

configs:
  prometheus_config:
    content: |
      global:
        scrape_interval: 15s # By default, scrape targets every 15 seconds.
        evaluation_interval: 15s # Evaluate rules every 15 seconds.

      scrape_configs:
        - job_name: polkadot
          static_configs:
            - targets:
                - polkadot_collator:9615    # relaychain metrics
                - polkadot_collator:9625    # parachain metrics
  promtail_config:
    content: |
      server:
        http_listen_port: 9080
      
      positions:
        filename: /tmp/positions.yaml
      
      clients:
        - url: http://loki:3100/loki/api/v1/push

      scrape_configs:
      - job_name: containers
        docker_sd_configs:
          - host: unix:///var/run/docker.sock
            refresh_interval: 5s
            filters:
              - name: name
                values: [polkadot_collator]
        relabel_configs:
          - source_labels: ['__meta_docker_container_name']
            regex: '/(.*)'
            target_label: 'container'
</code></pre>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h2 id="on-host-configuration"><a class="header" href="#on-host-configuration">On-Host Configuration</a></h2>
<p>The polkadot-sdk binary supports Prometheus metrics, which are exposed at <a href="http://host:9615/metrics">http://host:9615/metrics</a>. By default, this endpoint is only available on the local network interface. To expose it on all interfaces, you can use the --prometheus-external flag. However, when running a polkadot-parachain binary, managing the metrics becomes more complex due to two ports being used for different purposes.</p>
<h4 id="running-the-polkadot-binary-relay-chain"><a class="header" href="#running-the-polkadot-binary-relay-chain">Running the Polkadot Binary (Relay Chain)</a></h4>
<p>To run the Polkadot binary with Prometheus metrics exposed, use the following command:</p>
<pre><code>./polkadot --tmp --prometheus-external
</code></pre>
<h4 id="running-the-polkadot-parachain-binary-parachain"><a class="header" href="#running-the-polkadot-parachain-binary-parachain">Running the Polkadot-Parachain Binary (Parachain)</a></h4>
<p>For the Polkadot-Parachain binary, use the following command to expose Prometheus metrics on a specified port:</p>
<pre><code>./polkadot-parachain --tmp --prometheus-external --prometheus-port 9625 -- --tmp --prometheus-port 9615
</code></pre>
<p>As you can see above, running a polkadot-parachain binary can expose two different Prometheus port to ensure separation of metrics between relay chain and parachain.</p>
<h4 id="common-substrate-metrics"><a class="header" href="#common-substrate-metrics">Common Substrate metrics</a></h4>
<p>Here is a non-exhaustive lists of useful metrics exposed on the nodes <code>metrics</code> endpoint:</p>
<ul>
<li><code>substrate_block_height</code>: the best and finalized block number for this node. This should be increasing when your node is producing or syncing blocks from the network.</li>
<li><code>substrate_sub_libp2p_peers_count</code>: the number of node peers</li>
<li><code>substrate_sub_txpool_validations_finished</code>: transactions in the node transaction queue, there should be some but not too high counts which would mean that the transaction are not propagated to other nodes.</li>
<li><code>substrate_sub_libp2p_incoming_connections_total</code>: this must be constantly increasing especially on validators and collators as those active nodes need to be able to receive incoming connections from other peers. This can be a sign that the node is incorrectly configured to allow p2p access (--listen-addr/--public-addr).</li>
</ul>
<h4 id="differences-in-metric-labels"><a class="header" href="#differences-in-metric-labels">Differences in Metric Labels</a></h4>
<p>There are key differences in the labels of metrics exposed by the relay chain and parachain binaries:</p>
<p><em>Relay Chain Metrics at Port 9615</em></p>
<pre><code># TYPE polkadot_memory_allocated gauge
polkadot_memory_allocated{chain=&quot;rococo_local_testnet&quot;} 225670544

# HELP polkadot_memory_resident Bytes allocated by the node, and held in RAM
# TYPE polkadot_memory_resident gauge
polkadot_memory_resident{chain=&quot;rococo_local_testnet&quot;} 679718912

# HELP polkadot_node_is_active_validator Tracks if the validator is in the active set. Updates at session boundary.
# TYPE polkadot_node_is_active_validator gauge
polkadot_node_is_active_validator{chain=&quot;rococo_local_testnet&quot;} 0
</code></pre>
<p><em>Parachain Metrics at Port 9625</em></p>
<pre><code># HELP substrate_block_height Block height info of the chain
# TYPE substrate_block_height gauge
substrate_block_height{status=&quot;best&quot;,chain=&quot;local_testnet&quot;} 0
substrate_block_height{status=&quot;finalized&quot;,chain=&quot;local_testnet&quot;} 0
substrate_block_height{status=&quot;sync_target&quot;,chain=&quot;local_testnet&quot;} 0
</code></pre>
<h4 id="best-practices-1"><a class="header" href="#best-practices-1">Best Practices</a></h4>
<p>To avoid confusion caused by running metrics on different ports, it is recommended to maintain uniformity by using the same Prometheus port (default is 9615) for all relay chain metrics. The chain label in the metrics helps determine which metric belongs to which chain, ensuring clarity and organization.</p>
<p>By following this guide, you can effectively expose and manage Prometheus metrics for both the Polkadot relay chain and parachain binaries.</p>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="keys-and-accounts"><a class="header" href="#keys-and-accounts">Keys And Accounts</a></h1>
<p>This page will describe some basic information on keys and accounts. For a more general and detailed explanation see <a href="https://wiki.polkadot.network/docs/learn-accounts">learn accounts</a> on the polkadot wiki page.</p>
<h2 id="encryption-schemes"><a class="header" href="#encryption-schemes">Encryption Schemes</a></h2>
<table><thead><tr><th>Name</th><th>Type</th></tr></thead><tbody>
<tr><td>ed25519</td><td>The vanilla ed25519 implementation using Schnorr signatures.</td></tr>
<tr><td>sr25519</td><td>The Schnorrkel/Ristretto sr25519 variant using Schnorr signatures. (default)</td></tr>
<tr><td>ecdsa</td><td>ECDSA signatures on secp256k1</td></tr>
</tbody></table>
<h2 id="session-key-types"><a class="header" href="#session-key-types">Session Key Types</a></h2>
<table><thead><tr><th>Name</th><th>Type</th></tr></thead><tbody>
<tr><td>grandpa</td><td>ed25519</td></tr>
<tr><td>authority_discovery</td><td>sr25519</td></tr>
<tr><td>aura</td><td>sr25519</td></tr>
<tr><td>babe</td><td>sr25519</td></tr>
<tr><td>para_validator</td><td>sr25519</td></tr>
<tr><td>para_assignment</td><td>sr25519</td></tr>
<tr><td>beefy</td><td>ecdsa</td></tr>
</tbody></table>
<h2 id="key-generation-and-inspection"><a class="header" href="#key-generation-and-inspection">Key Generation and Inspection</a></h2>
<p>You can use <code>polkadot-parachain keys</code> or the <code>subkey</code> command to generate and inspect keys.</p>
<p>Two important subcommands are:</p>
<ul>
<li><code>generate</code> Create a new random account and print the private key data or save to a file.</li>
<li><code>inspect</code> View the account data for an account by passing a secret phrase or seed.</li>
</ul>
<p>Some important options are:</p>
<ul>
<li><code>--network</code> specify the network the keys will be used on, default is substrate.</li>
<li><code>--scheme</code> the scheme for the keys, default is sr25519.</li>
</ul>
<h2 id="generate"><a class="header" href="#generate">Generate</a></h2>
<h3 id="create-a-random-account-key"><a class="header" href="#create-a-random-account-key">Create a Random Account Key</a></h3>
<pre><code class="language-bash">$ polkadot-parachain key generate
Secret phrase:       test test test test test test test test test test test junk
  Network ID:        substrate
  Secret seed:       0x4ca479f5e0dc0ee04ebcbadb64c220267dad42b8cfa4da1f0874787523b4709c
  Public key (hex):  0xd000ac5048ae858aca2e6aa43e00661562a47026fe88ff83992430204a159752
  Account ID:        0xd000ac5048ae858aca2e6aa43e00661562a47026fe88ff83992430204a159752
  Public key (SS58): 5GmS1wtCfR4tK5SSgnZbVT4kYw5W8NmxmijcsxCQE6oLW6A8
  SS58 Address:      5GmS1wtCfR4tK5SSgnZbVT4kYw5W8NmxmijcsxCQE6oLW6A8
</code></pre>
<p>You can save it to a file using </p>
<h2 id="inspection"><a class="header" href="#inspection">Inspection</a></h2>
<h3 id="inspect-created-key"><a class="header" href="#inspect-created-key">Inspect Created Key</a></h3>
<pre><code class="language-bash">$ polkadot-parachain key inspect &quot;test test test test test test test test test test test junk&quot;
Secret phrase:       test test test test test test test test test test test junk
  Network ID:        substrate
  Secret seed:       0x4ca479f5e0dc0ee04ebcbadb64c220267dad42b8cfa4da1f0874787523b4709c
  Public key (hex):  0xd000ac5048ae858aca2e6aa43e00661562a47026fe88ff83992430204a159752
  Account ID:        0xd000ac5048ae858aca2e6aa43e00661562a47026fe88ff83992430204a159752
  Public key (SS58): 5GmS1wtCfR4tK5SSgnZbVT4kYw5W8NmxmijcsxCQE6oLW6A8
  SS58 Address:      5GmS1wtCfR4tK5SSgnZbVT4kYw5W8NmxmijcsxCQE6oLW6A8
</code></pre>
<h3 id="inspect-created-key-with-hard-derivation-stash0"><a class="header" href="#inspect-created-key-with-hard-derivation-stash0">Inspect Created Key With Hard Derivation //Stash//0</a></h3>
<pre><code class="language-bash">$ polkadot-parachain key inspect &quot; test test test test test test test test test test test junk//Stash//0&quot;
Secret Key URI ` test test test test test test test test test test test junk//Stash//0` is account:
  Network ID:        substrate
  Secret seed:       0x88f170a1438f83de6c2b845282ebb577dfcaee4c896655e64777ba220b3ad33d
  Public key (hex):  0xa2a73aaf576ed83371c92642a80706bf4b007c40f689d649aa7b075833d7242c
  Account ID:        0xa2a73aaf576ed83371c92642a80706bf4b007c40f689d649aa7b075833d7242c
  Public key (SS58): 5FjyHtMBm7kArqgSX52DAQvZeJ2Tq5sQBwFfSmZ3NWMHs4Be
  SS58 Address:      5FjyHtMBm7kArqgSX52DAQvZeJ2Tq5sQBwFfSmZ3NWMHs4Be
</code></pre>
<h2 id="managing-a-node-session-keys"><a class="header" href="#managing-a-node-session-keys">Managing a node session keys</a></h2>
<p>In Polkadot, <strong>Session Keys</strong> refer to the hot keys set on a node to perform various network operations, such as collating or validating blocks.</p>
<h3 id="create-new-session-keys-on-a-node-via-the-author_rotatekeys-rpc-method"><a class="header" href="#create-new-session-keys-on-a-node-via-the-author_rotatekeys-rpc-method">Create new session keys on a node via the <code>author_rotateKeys</code> RPC method</a></h3>
<p>On the remote machine hosting the node, you can create new session keys with the following commmand:</p>
<pre><code class="language-bash">curl -H &quot;Content-Type: application/json&quot; -d '{&quot;id&quot;:1, &quot;jsonrpc&quot;:&quot;2.0&quot;, &quot;method&quot;: &quot;author_rotateKeys&quot;, &quot;params&quot;:[]}' http://localhost:9944
</code></pre>
<p>The response output will then show the hex-encoded concatenation of the session public keys. This is intended to be submitted on-chain using the <a href="https://wiki.polkadot.network/docs/maintain-guides-how-to-validate-polkadot#submitting-the-setkeys-transaction">session.setKeys extrinsics</a>.</p>
<h3 id="insert-a-specific-key-onto-a-node-keystore-via-the-author_insertkey-rpc-method"><a class="header" href="#insert-a-specific-key-onto-a-node-keystore-via-the-author_insertkey-rpc-method">Insert a specific key onto a node keystore via the <code>author_insertKey</code> RPC method</a></h3>
<p>To inject a key via RPC, use the following command:</p>
<pre><code class="language-bash">curl -H &quot;Content-Type: application/json&quot; \ --data '{ &quot;jsonrpc&quot;:&quot;2.0&quot;, &quot;method&quot;:&quot;author_insertKey&quot;, &quot;params&quot;:[&quot;'&quot;${KEY_TYPE}&quot;'&quot;, &quot;'&quot;${KEY_SEED}&quot;'&quot;],&quot;id&quot;:1 }' http://localhost:9933
</code></pre>
<p>Set:</p>
<ul>
<li><code>KEY_TYPE</code> to a session key type (eg. <code>babe</code>, <code>grandpa</code>)</li>
<li><code>KEY_SEED</code> to a secret seed or private key</li>
</ul>
<h3 id="insert-a-specific-key-onto-a-node-keystore-using-the-node-binary"><a class="header" href="#insert-a-specific-key-onto-a-node-keystore-using-the-node-binary">Insert a specific key onto a node keystore using the node binary</a></h3>
<p>To inject a key via the node binary, use the following command:</p>
<pre><code class="language-bash">polkadot-parachain key insert -d &lt;my_chain_folder&gt; --key-type ${KEY_TYPE} --scheme ${KEY_SCHEME} --suri ${KEY_FILE}
</code></pre>
<ul>
<li><code>KEY_TYPE</code>: a session key type (eg. <code>babe</code>, <code>grandpa</code>)</li>
<li><code>KEY_SCHEME</code>: an encryption scheme (eg. <code>sr25519</code>, <code>ed25519</code>, <code>ecdsa</code>)</li>
<li><code>KEY_FILE</code>: a plain text file which contains the seed or private key</li>
</ul>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="custom-chain---chainspecs"><a class="header" href="#custom-chain---chainspecs">Custom Chain - Chainspecs</a></h1>
<p>This section will explain what is required to build a custom chain spec for your own network.
For more in depth explanations on how chainspecs works internally, refer to the <a href="https://paritytech.github.io/polkadot-sdk/master/polkadot_sdk_docs/reference_docs/chain_spec_genesis/index.html">Polkadot-sdk Chainspec docs</a></p>
<h2 id="create-chain-spec-with-the-node-binary"><a class="header" href="#create-chain-spec-with-the-node-binary">Create Chain Spec with the node binary</a></h2>
<p>You can create a plain chainspec for your network with:</p>
<pre><code class="language-bash">node build-spec –chain chain-name --disable-default-bootnode &gt; custom-chainspec.json
</code></pre>
<p><strong>Important Fields</strong>:</p>
<table><thead><tr><th>Field</th><th>Purpose</th></tr></thead><tbody>
<tr><td>Name</td><td>Name of the network</td></tr>
<tr><td>id</td><td>Id of network, also used for the filesystem path</td></tr>
<tr><td>bootNodes</td><td>List of multiaddr’s of bootnodes for the network</td></tr>
<tr><td>protocolId</td><td>A unique identifier for the protocol</td></tr>
<tr><td>para_id</td><td>(Parachains only) numerical ID of the parachain slot</td></tr>
<tr><td>relay_chain</td><td>(Parachains only) Id of the relaychain to connect to</td></tr>
<tr><td>genesis.runtimeGenesis</td><td>(Plain chainspec only) Configuration of the genesis runtime</td></tr>
<tr><td>genesis.raw</td><td>(Raw chainspec only) Serialization of the raw of the genesis storage</td></tr>
</tbody></table>
<p>Once the values have been updated this chainspec should be converted in raw format using the command:</p>
<pre><code class="language-bash">node build-spec –chain custom-chainspec.json –raw &gt; custom-chainspec-raw.json
</code></pre>
<h2 id="using-the-chain-spec-builder"><a class="header" href="#using-the-chain-spec-builder">Using the chain-spec-builder</a></h2>
<p>The chain-spec builder is a utility that can create a chainspec from a runtime wasm. The tool's linux binary can be downloaded from the <a href="https://github.com/paritytech/polkadot-sdk/releases">polkadot-sdk release page</a> or built from sources in <a href="https://github.com/paritytech/polkadot-sdk/tree/master/substrate/bin/utils/chain-spec-builder">polkadot-sdk/substrate/bin/utils/chain-spec-builder</a>.</p>
<h3 id="create-a-genesisjson-file-from-presets"><a class="header" href="#create-a-genesisjson-file-from-presets">Create a genesis.json file from presets</a></h3>
<p>Runtimes can have config presets which are examples of valid genesis configuration files that can be edited for customizing chainspecs.</p>
<h4 id="list-the-available-presets-of-a-runtime"><a class="header" href="#list-the-available-presets-of-a-runtime">List the available presets of a runtime</a></h4>
<pre><code>$ chain-spec-builder list-presets --runtime-wasm-path rococo_runtime-v1015000.compact.compressed.wasm
</code></pre>
<pre><code class="language-json">{
  &quot;presets&quot;: [
    &quot;local_testnet&quot;,
    &quot;development&quot;,
    &quot;staging_testnet&quot;,
    &quot;wococo_local_testnet&quot;,
    &quot;versi_local_testnet&quot;
  ]
}
</code></pre>
<p>Unfortunately, not all existing runtimes have embedded presets, if those are not available, you should ask your chain developers to move their genesis config presets from the node binary to the runtime (see eg. <a href="https://github.com/paritytech/polkadot-sdk/pull/4739">polkadot-sdk#4749</a>).</p>
<h4 id="export-a-config-preset-from-a-runtime-file"><a class="header" href="#export-a-config-preset-from-a-runtime-file">Export a config preset from a runtime file</a></h4>
<pre><code>$ chain-spec-builder display-preset --runtime-wasm-path rococo_runtime-v1015000.compact.compressed.wasm --preset-name staging_testnet &gt; rococo-genesis.json
</code></pre>
<details>
<summary>rococo-genesis.json</summary>
<code style="display:block; white-space:pre-wrap">
{
  "babe": {
    "epochConfig": {
      "allowed_slots": "PrimaryAndSecondaryVRFSlots",
      "c": [
        1,
        4
      ]
    }
  },
  "balances": {
    "balances": [
      [
        "5DwBmEFPXRESyEam5SsQF1zbWSCn2kCjyLW51hJHXe9vW4xs",
        1000000000000000000
      ],
      [
        "5EHZkbp22djdbuMFH9qt1DVzSCvqi3zWpj6DAYfANa828oei",
        100000000000000
      ],
      [
        "5DvH8oEjQPYhzCoQVo7WDU91qmQfLZvxe9wJcrojmJKebCmG",
        100000000000000
      ],
      [
        "5FPMzsezo1PRxYbVpJMWK7HNbR2kUxidsAAxH4BosHa4wd6S",
        100000000000000
      ],
      [
        "5DMNx7RoX6d7JQ38NEM7DWRcW2THu92LBYZEWvBRhJeqcWgR",
        100000000000000
      ],
      [
        "5C8AL1Zb4bVazgT3EgDxFgcow1L4SJjVu44XcLC9CrYqFN4N",
        100000000000000
      ],
      [
        "5C8XbDXdMNKJrZSrQURwVCxdNdk8AzG6xgLggbzuA399bBBF",
        100000000000000
      ],
      [
        "5HinEonzr8MywkqedcpsmwpxKje2jqr9miEwuzyFXEBCvVXM",
        100000000000000
      ],
      [
        "5Ey3NQ3dfabaDc16NUv7wRLsFCMDFJSqZFzKVycAsWuUC6Di",
        100000000000000
      ]
    ]
  },
  "configuration": {
    "config": {
      "approval_voting_params": {
        "max_approval_coalesce_count": 1
      },
      "async_backing_params": {
        "allowed_ancestry_len": 2,
        "max_candidate_depth": 3
      },
      "code_retention_period": 1200,
      "dispute_period": 6,
      "dispute_post_conclusion_acceptance_period": 100,
      "executor_params": [],
      "hrmp_channel_max_capacity": 8,
      "hrmp_channel_max_message_size": 1048576,
      "hrmp_channel_max_total_size": 8192,
      "hrmp_max_message_num_per_candidate": 5,
      "hrmp_max_parachain_inbound_channels": 4,
      "hrmp_max_parachain_outbound_channels": 4,
      "hrmp_recipient_deposit": 0,
      "hrmp_sender_deposit": 0,
      "max_code_size": 3145728,
      "max_downward_message_size": 1048576,
      "max_head_data_size": 32768,
      "max_pov_size": 5242880,
      "max_upward_message_num_per_candidate": 5,
      "max_upward_message_size": 51200,
      "max_upward_queue_count": 8,
      "max_upward_queue_size": 1048576,
      "max_validators": null,
      "minimum_backing_votes": 2,
      "minimum_validation_upgrade_delay": 5,
      "n_delay_tranches": 25,
      "needed_approvals": 2,
      "no_show_slots": 2,
      "node_features": {
        "bits": 8,
        "data": [
          2
        ],
        "head": {
          "index": 0,
          "width": 8
        },
        "order": "bitvec::order::Lsb0"
      },
      "pvf_voting_ttl": 2,
      "relay_vrf_modulo_samples": 2,
      "scheduler_params": {
        "group_rotation_frequency": 20,
        "lookahead": 2,
        "max_availability_timeouts": 0,
        "max_validators_per_core": null,
        "num_cores": 0,
        "on_demand_base_fee": 10000000,
        "on_demand_fee_variability": 30000000,
        "on_demand_queue_max_size": 10000,
        "on_demand_target_queue_utilization": 250000000,
        "paras_availability_period": 4,
        "ttl": 5
      },
      "validation_upgrade_cooldown": 2,
      "validation_upgrade_delay": 2,
      "zeroth_delay_tranche_width": 0
    }
  },
  "registrar": {
    "nextFreeParaId": 2000
  },
  "session": {
    "keys": [
      [
        "5EHZkbp22djdbuMFH9qt1DVzSCvqi3zWpj6DAYfANa828oei",
        "5EHZkbp22djdbuMFH9qt1DVzSCvqi3zWpj6DAYfANa828oei",
        {
          "authority_discovery": "5HbSgM72xVuscsopsdeG3sCSCYdAeM1Tay9p79N6ky6vwDGq",
          "babe": "5Fh6rDpMDhM363o1Z3Y9twtaCPfizGQWCi55BSykTQjGbP7H",
          "beefy": "KWAWRuYGuB7eAXWBsb7ZtaA267AUABJCP45vA7T61bNKG3zMc",
          "grandpa": "5CPd3zoV9Aaah4xWucuDivMHJ2nEEmpdi864nPTiyRZp4t87",
          "para_assignment": "5HQdwiDh8Qtd5dSNWajNYpwDvoyNWWA16Y43aEkCNactFc2b",
          "para_validator": "5CP6oGfwqbEfML8efqm1tCZsUgRsJztp9L8ZkEUxA16W8PPz"
        }
      ],
      [
        "5DvH8oEjQPYhzCoQVo7WDU91qmQfLZvxe9wJcrojmJKebCmG",
        "5DvH8oEjQPYhzCoQVo7WDU91qmQfLZvxe9wJcrojmJKebCmG",
        {
          "authority_discovery": "5HeXbwb5PxtcRoopPZTp5CQun38atn2UudQ8p2AxR5BzoaXw",
          "babe": "5DLjSUfqZVNAADbwYLgRvHvdzXypiV1DAEaDMjcESKTcqMoM",
          "beefy": "KWCXxi2nesB7EUaPMr5oExVcaJ5AmN5adHtWdXeqoEhmMcTK7",
          "grandpa": "5HnDVBN9mD6mXyx8oryhDbJtezwNSj1VRXgLoYCBA6uEkiao",
          "para_assignment": "5ES3fw5X4bndSgLNmtPfSbM2J1kLqApVB2CCLS4CBpM1UxUZ",
          "para_validator": "5EPEWRecy2ApL5n18n3aHyU1956zXTRqaJpzDa9DoqiggNwF"
        }
      ],
      [
        "5FPMzsezo1PRxYbVpJMWK7HNbR2kUxidsAAxH4BosHa4wd6S",
        "5FPMzsezo1PRxYbVpJMWK7HNbR2kUxidsAAxH4BosHa4wd6S",
        {
          "authority_discovery": "5D4r6YaB6F7A7nvMRHNFNF6zrR9g39bqDJFenrcaFmTCRwfa",
          "babe": "5GpZhzAVg7SAtzLvaAC777pjquPEcNy1FbNUAG2nZvhmd6eY",
          "beefy": "KWCGCQqZsnEB4jitvZstHq9dxJE4unuAga5naKmPUUs1oVya8",
          "grandpa": "5HAes2RQYPbYKbLBfKb88f4zoXv6pPA6Ke8CjN7dob3GpmSP",
          "para_assignment": "5CtK7JHv3h6UQZ44y54skxdwSVBRtuxwPE1FYm7UZVhg8rJV",
          "para_validator": "5FtAGDZYJKXkhVhAxCQrXmaP7EE2mGbBMfmKDHjfYDgq2BiU"
        }
      ],
      [
        "5DMNx7RoX6d7JQ38NEM7DWRcW2THu92LBYZEWvBRhJeqcWgR",
        "5DMNx7RoX6d7JQ38NEM7DWRcW2THu92LBYZEWvBRhJeqcWgR",
        {
          "authority_discovery": "5CtgRR74VypK4h154s369abs78hDUxZSJqcbWsfXvsjcHJNA",
          "babe": "5EjkyPCzR2SjhDZq8f7ufsw6TfkvgNRepjCRQFc4TcdXdaB1",
          "beefy": "KW8tZu7Cf6dTjGHR6SwQcoAry4LUVCTq3pzfUNSketjYc8NPC",
          "grandpa": "5DJV3zCBTJBLGNDCcdWrYxWDacSz84goGTa4pFeKVvehEBte",
          "para_assignment": "5F1FZWZSj3JyTLs8sRBxU6QWyGLSL9BMRtmSKDmVEoiKFxSP",
          "para_validator": "5F9FsRjpecP9GonktmtFL3kjqNAMKjHVFjyjRdTPa4hbQRZA"
        }
      ],
      [
        "5C8AL1Zb4bVazgT3EgDxFgcow1L4SJjVu44XcLC9CrYqFN4N",
        "5C8AL1Zb4bVazgT3EgDxFgcow1L4SJjVu44XcLC9CrYqFN4N",
        {
          "authority_discovery": "5DABsdQCDUGuhzVGWe5xXzYQ9rtrVxRygW7RXf9Tsjsw1aGJ",
          "babe": "5Et3tfbVf1ByFThNAuUq5pBssdaPPskip5yob5GNyUFojXC7",
          "beefy": "KW8bmi1qiPmp5x2PAfqBeQ8MdAGWDXo7fYeAAB92oWgXdvXmL",
          "grandpa": "5EX1JBghGbQqWohTPU6msR9qZ2nYPhK9r3RTQ2oD1K8TCxaG",
          "para_assignment": "5CaZuueRVpMATZG4hkcrgDoF4WGixuz7zu83jeBdY3bgWGaG",
          "para_validator": "5EUNaBpX9mJgcmLQHyG5Pkms6tbDiKuLbeTEJS924Js9cA1N"
        }
      ],
      [
        "5C8XbDXdMNKJrZSrQURwVCxdNdk8AzG6xgLggbzuA399bBBF",
        "5C8XbDXdMNKJrZSrQURwVCxdNdk8AzG6xgLggbzuA399bBBF",
        {
          "authority_discovery": "5CZdFnyzZvKetZTeUwj5APAYskVJe4QFiTezo5dQNsrnehGd",
          "babe": "5GHWB8ZDzegLcMW7Gdd1BS6WHVwDdStfkkE4G7KjPjZNJBtD",
          "beefy": "KW2vnN5A1F59icBUNrF3gpcTdDMb8pvYPVACctkGHkdAW3oDB",
          "grandpa": "5GzDPGbUM9uH52ZEwydasTj8edokGUJ7vEpoFWp9FE1YNuFB",
          "para_assignment": "5DnsSy8a8pfE2aFjKBDtKw7WM1V4nfE5sLzP15MNTka53GqS",
          "para_validator": "5CmLCFeSurRXXtwMmLcVo7sdJ9EqDguvJbuCYDcHkr3cpqyE"
        }
      ],
      [
        "5HinEonzr8MywkqedcpsmwpxKje2jqr9miEwuzyFXEBCvVXM",
        "5HinEonzr8MywkqedcpsmwpxKje2jqr9miEwuzyFXEBCvVXM",
        {
          "authority_discovery": "5ELv74v7QcsS6FdzvG4vL2NnYDGWmRnJUSMKYwdyJD7Xcdi7",
          "babe": "5EeCsC58XgJ1DFaoYA1WktEpP27jvwGpKdxPMFjicpLeYu96",
          "beefy": "KWA93sGFQ4a2iMR9DGQt7iQj3NZwKW8mWDZU6gZzU6jYubBMX",
          "grandpa": "5DnEySxbnppWEyN8cCLqvGjAorGdLRg2VmkY96dbJ1LHFK8N",
          "para_assignment": "5HjRTLWcQjZzN3JDvaj1UzjNSayg5ZD9ZGWMstaL7Ab2jjAa",
          "para_validator": "5CAC278tFCHAeHYqE51FTWYxHmeLcENSS1RG77EFRTvPZMJT"
        }
      ],
      [
        "5Ey3NQ3dfabaDc16NUv7wRLsFCMDFJSqZFzKVycAsWuUC6Di",
        "5Ey3NQ3dfabaDc16NUv7wRLsFCMDFJSqZFzKVycAsWuUC6Di",
        {
          "authority_discovery": "5DqAvikdpfRdk5rR35ZobZhqaC5bJXZcEuvzGtexAZP1hU3T",
          "babe": "5H168nKX2Yrfo3bxj7rkcg25326Uv3CCCnKUGK6uHdKMdPt8",
          "beefy": "KW54aj4HK5xHt3eqKqLuPRMDY8kRi4VgKycb3Uq7Bu6fQxqwA",
          "grandpa": "5DrA2fZdzmNqT5j6DXNwVxPBjDV9jhkAqvjt6Us3bQHKy3cF",
          "para_assignment": "5DhDcHqwxoes5s89AyudGMjtZXx1nEgrk5P45X88oSTR3iyx",
          "para_validator": "5Gx6YeNhynqn8qkda9QKpc9S7oDr4sBrfAu516d3sPpEt26F"
        }
      ]
    ]
  },
  "sudo": {
    "key": "5DwBmEFPXRESyEam5SsQF1zbWSCn2kCjyLW51hJHXe9vW4xs"
  }
}
</code>
</details>
<h3 id="create-a-chain-spec-from-a-runtime-wasm-file"><a class="header" href="#create-a-chain-spec-from-a-runtime-wasm-file">Create a chain-spec from a runtime wasm file</a></h3>
<pre><code class="language-bash">chain-spec-builder -c chainspec.json create -n &quot;Test Chain&quot; -i test-chain -t live -r runtime.wasm patch genesis.json
</code></pre>
<h3 id="verify-a-chain-spec-file"><a class="header" href="#verify-a-chain-spec-file">Verify a chain-spec file</a></h3>
<pre><code class="language-bash">chain-spec-builder verify chainspec.json
</code></pre>
<h3 id="convert-a-plain-chain-spec-to-raw"><a class="header" href="#convert-a-plain-chain-spec-to-raw">Convert a plain chain-spec to raw</a></h3>
<pre><code class="language-bash">chain-spec-builder convert-to-raw chainspec.json  &gt; chainspec.raw.json
</code></pre>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer><div style="break-before: page; page-break-before: always;"></div><h1 id="infrastructure-tooling-references"><a class="header" href="#infrastructure-tooling-references">Infrastructure Tooling References</a></h1>
<p>This section is for listing some useful projects and tools that are relevant for node operators and developers. A community maintained <a href="https://github.com/substrate-developer-hub/awesome-substrate">Awesome Substrate</a> is a more detailed general list.</p>
<h2 id="deployment"><a class="header" href="#deployment">Deployment</a></h2>
<table><thead><tr><th>Project</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="https://github.com/paritytech/helm-charts">Parity Helm Charts collection</a></td><td>Parity &amp; Polkadot Helm charts collection</td></tr>
<tr><td><a href="https://github.com/paritytech/ansible-galaxy">Polkadot Ansible collection</a></td><td>Polkadot Ansible Collection</td></tr>
</tbody></table>
<h2 id="tooling"><a class="header" href="#tooling">Tooling</a></h2>
<p>For an up-to-date list of Polkadot related tooling, check the <a href="https://wiki.polkadot.network/docs/build-tools-index">Polkadot Wiki Tool Index</a>.</p>
<h2 id="indexing-chain-data"><a class="header" href="#indexing-chain-data">Indexing Chain Data</a></h2>
<table><thead><tr><th>Project</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="https://github.com/paritytech/substrate-archive.git">Substrate archive</a></td><td>Blockchain indexing engine using PostgreSQL</td></tr>
<tr><td><a href="https://github.com/subsquid/squid">Subsquid</a></td><td>Blockchain indexing engine using GraphQL</td></tr>
<tr><td><a href="https://academy.subquery.network/">SubQuery</a></td><td>Open source GraphQL indexing of any Substrate network (including EVM and WASM smart contract data) directly from the RPC node. SubQuery does not require any preprocessed data making it suitable for fast changing testnets</td></tr>
</tbody></table>
<h2 id="cli-utilities"><a class="header" href="#cli-utilities">CLI Utilities</a></h2>
<table><thead><tr><th>Project</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="https://github.com/paritytech/substrate/tree/master/bin/utils/subkey">Subkey</a></td><td>Used for generating and restoring keys. Works with multiple networks and key schemes</td></tr>
<tr><td><a href="https://github.com/polkadot-js/tools">polkadot-js-tools</a></td><td>A very flexible utility for executing API calls or running queries.</td></tr>
<tr><td><a href="https://github.com/paritytech/subxt">Subxt</a></td><td>Submits extrinsics via RPC</td></tr>
</tbody></table>
<h2 id="monitoring"><a class="header" href="#monitoring">Monitoring</a></h2>
<table><thead><tr><th>Project</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="https://gitlab.com/Polkabot/polkabot">Polkabot</a></td><td>Polkabot is a Matrix chatbot that keeps an eye on the Polkadot network.</td></tr>
<tr><td><a href="https://github.com/w3f/polkadot-watcher-transaction">polkadot-watcher-transaction</a></td><td>The main use case of this application consits of a scanner that can be configured to start from a configured block number, and then it keeps monitoring the on-chain situation delivering alerts to a notifier.</td></tr>
<tr><td><a href="https://github.com/w3f/polkadot-watcher-validator">polkadot-watcher-validator</a></td><td>The watcher is a nodeJs application meant to be connected with a substrate based node through a web socket. It can then monitor the status of the node, leveraging on mechanisms such as the builtin heartbeat.</td></tr>
<tr><td><a href="https://github.com/w3f/polkadot-k8s-payouts">polkadot-k8s-payouts</a></td><td>Tool that automatically claims your Kusama/Polkadot validator rewards.</td></tr>
</tbody></table>
<footer id="last-change">Last change: 2024-07-25, commit: <a href="https://github.com/paritytech/devops-guide/commit/dc3e980">dc3e980</a></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
                
    </body>
</html>
